# ESPnet-TTS 适配器实施计划

## 一、目标
实现 ESPnet-TTS 适配器，支持在 AI-Sound 系统中通过统一 API 路由调用 ESPnet-TTS 引擎，实现文本到语音的高质量合成，作为 MegaTTS3 不可用时的主力后端。

---

## 二、实施步骤

### 1. 需求分析与接口设计（0.5天）
- 明确 ESPnet-TTS 的调用方式（本地/远程/容器）
- 梳理与现有统一 TTS 接口的参数映射关系
- 设计适配器输入输出（如：文本、音色、情感、采样率、返回音频格式）

### 2. 环境准备与依赖安装（0.5天）
- 配置 ESPnet-TTS 运行环境（可用官方 Docker 或本地 Python 环境）
- 安装必要依赖（如 espnet、torch、soundfile 等）
- 准备基础模型和测试用例

### 3. 适配器模块开发（1天）
- 在 `/services/api/src/tts/` 下新建 `espnet_adapter.py`
- 实现核心方法：
  - `synthesize(text, voice_id, emotion, ...)`：调用 ESPnet-TTS 生成音频
  - 参数校验与转换
  - 结果格式化（如返回 WAV/MP3 字节流）
- 日志与异常处理

### 4. 与引擎路由集成（0.5天）
- 在 `engine.py` 注册 ESPnet-TTS 适配器
- 支持通过 `engine=espnet` 参数自动路由到 ESPnet-TTS
- 保证与 MegaTTS3/云TTS 接口一致

### 5. 单元测试与集成测试（0.5天）
- 编写适配器单元测试（边界、异常、参数覆盖）
- 集成 API 接口测试，确保 `/api/tts/text?engine=espnet` 可用
- 验证音频质量与参数生效

### 6. 文档与部署（0.5天）
- 更新 API 文档，说明 ESPnet-TTS 支持的参数与用法
- 部署到测试环境，团队联调
- 记录常见问题与排查方法

---

## 三、时间计划表

| 阶段                | 主要任务                         | 预计用时 |
|---------------------|----------------------------------|----------|
| 需求分析与接口设计  | 参数梳理、接口方案               | 0.5天    |
| 环境准备            | 依赖安装、模型准备               | 0.5天    |
| 适配器开发          | 代码实现、参数映射、异常处理     | 1天      |
| 路由集成            | engine.py注册、参数路由          | 0.5天    |
| 测试                | 单元/集成测试、音频质量验证      | 0.5天    |
| 文档与部署          | API文档、部署、问题记录          | 0.5天    |
| **合计**            |                                  | **3.5天**|

---

## 四、交付标准
- 适配器代码通过单元和集成测试，接口参数与主路由一致
- 支持文本、音色、情感等参数，音频输出格式正确
- API 文档更新，团队成员可直接调用
- 常见问题与排查方法文档化

---

如需细化每个阶段的具体任务或代码模板，请随时补充说明。
