# åœºæ™¯åˆ†ææœåŠ¡è®¾è®¡

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½

ä¸ºTangoFluxç¯å¢ƒéŸ³ç”Ÿæˆæä¾›ç²¾ç¡®çš„åœºæ™¯æ ‡ç­¾ï¼Œæ”¯æŒå¤§æ¨¡å‹å¢å¼ºåˆ†æã€‚

## ğŸ”¥ å…³é”®ä¼˜åŠ¿

- **å¤§æ¨¡å‹é©±åŠ¨**ï¼šGPT-4o/Claudeæ·±åº¦ç†è§£åœºæ™¯è¯­ä¹‰
- **æœ¬åœ°å…œåº•**ï¼šOllamaç¡®ä¿æœåŠ¡å¯ç”¨æ€§  
- **æ™ºèƒ½ç¼“å­˜**ï¼šé¿å…é‡å¤åˆ†æï¼Œé™ä½æˆæœ¬
- **åˆ›æ„å¢å¼º**ï¼šAIå»ºè®®ä¸“ä¸šçº§éŸ³æ•ˆç»„åˆ

## ğŸ§  åŒé‡åˆ†æç­–ç•¥

```python
class HybridSceneAnalyzer:
    def analyze_scene(self, text: str) -> EnhancedSceneInfo:
        # ç­–ç•¥1: æœ¬åœ°å¿«é€Ÿåˆ†æ
        local_result = self.ollama_analyzer.analyze(text)
        
        # ç­–ç•¥2: å¤§æ¨¡å‹æ·±åº¦åˆ†æ (å¼‚æ­¥)
        llm_result = await self.llm_analyzer.analyze(text)
        
        # èåˆç»“æœ
        return self.merge_analysis(local_result, llm_result)
```

## ğŸ¨ å¤§æ¨¡å‹åˆ›æ„å¢å¼º

### GPT-4oåœºæ™¯æ·±åº¦åˆ†æ
```python
CREATIVE_ANALYSIS_PROMPT = """
ä½œä¸ºä¸“ä¸šéŸ³æ•ˆè®¾è®¡å¸ˆï¼Œåˆ†æè¿™ä¸ªåœºæ™¯å¹¶è®¾è®¡ç”µå½±çº§éŸ³æ•ˆï¼š

æ–‡æœ¬ï¼š{text}

è¯·æä¾›ï¼š
1. åœºæ™¯åŸºç¡€ä¿¡æ¯(åœ°ç‚¹/å¤©æ°”/æ—¶é—´/æ°›å›´)
2. åˆ›æ„éŸ³æ•ˆå»ºè®®(ä¸»ç¯å¢ƒéŸ³+ç»†èŠ‚éŸ³æ•ˆ+æ°›å›´æ¸²æŸ“)
3. æƒ…èŠ‚ç´§å¼ åº¦è¯„ä¼°(1-10çº§)
4. è§’è‰²æƒ…ç»ªåˆ†æ
5. éŸ³æ•ˆåŠ¨æ€å˜åŒ–å»ºè®®

è¦æ±‚ï¼šéŸ³æ•ˆå…·æœ‰ç”µå½±çº§ä¸“ä¸šæ€§å’Œæ²‰æµ¸æ„Ÿã€‚
"""

async def analyze_with_creativity(self, text: str) -> CreativeSceneInfo:
    # å¤§æ¨¡å‹åˆ›æ„åˆ†æ
    creative_result = await self.gpt4_client.analyze(
        prompt=CREATIVE_ANALYSIS_PROMPT.format(text=text)
    )
    
    return CreativeSceneInfo(
        basic_scene=creative_result.scene,
        creative_suggestions=creative_result.sound_design,
        tension_level=creative_result.tension,
        emotion_analysis=creative_result.emotion
    )
```

## ğŸ’° æˆæœ¬æ§åˆ¶ç­–ç•¥

### æ™ºèƒ½ç¼“å­˜æœºåˆ¶
```python
class SmartCacheManager:
    async def get_or_analyze(self, text: str) -> SceneInfo:
        # 1. æ£€æŸ¥è¯­ä¹‰ç›¸ä¼¼åº¦ç¼“å­˜
        cache_key = self.get_semantic_hash(text)
        cached_result = await self.redis.get(cache_key)
        
        if cached_result and cached_result.confidence > 0.85:
            return cached_result
        
        # 2. æ‰§è¡Œæ–°åˆ†æ
        result = await self.analyze_scene(text)
        
        # 3. ç¼“å­˜é«˜è´¨é‡ç»“æœ
        if result.confidence > 0.8:
            await self.redis.set(cache_key, result, ttl=3600)
        
        return result
```

### åˆ†çº§å¤„ç†é™æœ¬
- **ç®€å•åœºæ™¯**: æœ¬åœ°Ollamaå¤„ç† (å…è´¹)
- **å¤æ‚åœºæ™¯**: GPT-3.5å¤„ç† (ä½æˆæœ¬)  
- **åˆ›æ„éœ€æ±‚**: GPT-4oå¤„ç† (é«˜è´¨é‡)

## ğŸ“Š æ ¸å¿ƒæ•°æ®ç»“æ„

```python
@dataclass 
class EnhancedSceneInfo:
    # åŸºç¡€åœºæ™¯ä¿¡æ¯
    location: str           # "indoor", "outdoor", "forest"
    weather: str           # "rainy", "sunny", "windy"  
    time: str             # "morning", "evening", "night"
    atmosphere: str       # "calm", "tense", "romantic"
    
    # å¤§æ¨¡å‹å¢å¼ºä¿¡æ¯
    creative_suggestions: List[str]  # AIåˆ›æ„éŸ³æ•ˆå»ºè®®
    tension_level: int               # ç´§å¼ åº¦1-10
    emotion_analysis: dict           # è§’è‰²æƒ…ç»ªåˆ†æ
    
    # è´¨é‡æ§åˆ¶
    confidence: float       # åˆ†æç½®ä¿¡åº¦
    processing_method: str  # "local" | "gpt3.5" | "gpt4o"
    cost_estimate: float   # åˆ†ææˆæœ¬é¢„ä¼°
```

---

**ä»·å€¼æ€»ç»“**: å¤§æ¨¡å‹é©±åŠ¨çš„æ™ºèƒ½åœºæ™¯åˆ†æï¼Œä¸ºTangoFluxæä¾›ç”µå½±çº§éŸ³æ•ˆè®¾è®¡å»ºè®®ï¼