import{c as t,A as $,_ as B,d as N,q as z,a as I,r as k,e as C,f as S,w as o,m as y,g as r,j as n,i as d,p as R,k as q}from"./index-827e089e.js";import{a as D}from"./axios-3a665b0f.js";import{I as E}from"./InboxOutlined-8a5fc653.js";var W={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M518.3 459a8 8 0 00-12.6 0l-112 141.7a7.98 7.98 0 006.3 12.9h73.9V856c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V613.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 459z"}},{tag:"path",attrs:{d:"M811.4 366.7C765.6 245.9 648.9 160 512.2 160S258.8 245.8 213 366.6C127.3 389.1 64 467.2 64 560c0 110.5 89.5 200 199.9 200H304c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8h-40.1c-33.7 0-65.4-13.4-89-37.7-23.5-24.2-36-56.8-34.9-90.6.9-26.4 9.9-51.2 26.2-72.1 16.7-21.3 40.1-36.8 66.1-43.7l37.9-9.9 13.9-36.6c8.6-22.8 20.6-44.1 35.7-63.4a245.6 245.6 0 0152.4-49.9c41.1-28.9 89.5-44.2 140-44.2s98.9 15.3 140 44.2c19.9 14 37.5 30.8 52.4 49.9 15.1 19.3 27.1 40.7 35.7 63.4l13.8 36.5 37.8 10C846.1 454.5 884 503.8 884 560c0 33.1-12.9 64.3-36.3 87.7a123.07 123.07 0 01-87.6 36.3H720c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h40.1C870.5 760 960 670.5 960 560c0-92.7-63.1-170.7-148.6-193.3z"}}]},name:"cloud-upload",theme:"outlined"};const G=W;function H(a){for(var e=1;e<arguments.length;e++){var s=arguments[e]!=null?Object(arguments[e]):{},u=Object.keys(s);typeof Object.getOwnPropertySymbols=="function"&&(u=u.concat(Object.getOwnPropertySymbols(s).filter(function(i){return Object.getOwnPropertyDescriptor(s,i).enumerable}))),u.forEach(function(i){J(a,i,s[i])})}return a}function J(a,e,s){return e in a?Object.defineProperty(a,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):a[e]=s,a}var F=function(e,s){var u=H({},e,s.attrs);return t($,H({},u,{icon:G}),null)};F.displayName="CloudUploadOutlined";F.inheritAttrs=!1;const Q=F;const X=N({name:"VoiceFeatureView",components:{InboxOutlined:E,CloudUploadOutlined:Q},setup(){const a=z(),e=I({name:"",tags:[],gender:void 0,age_group:void 0,description:""}),s=k(null),u=k("idle"),i=k(0),c=k("");return{formState:e,tagOptions:[{value:"male",label:"男性"},{value:"female",label:"女性"},{value:"young",label:"年轻"},{value:"mature",label:"成熟"},{value:"clear",label:"清晰"},{value:"deep",label:"低沉"},{value:"soft",label:"柔和"},{value:"energetic",label:"有活力"}],audioFile:s,uploadStatus:u,uploadProgress:i,errorMessage:c,uploadHeaders:{Accept:"application/json"},beforeUpload:l=>l.type==="audio/wav"||l.type==="audio/mp3"||l.type==="audio/mpeg"||l.type==="audio/flac"||/\.(wav|mp3|flac)$/i.test(l.name)?l.size/1024/1024<20?(s.value=l,!1):(y.error("音频文件大小不能超过20MB！"),!1):(y.error("只能上传WAV、MP3或FLAC音频文件！"),!1),customUploadRequest:async({file:l,onProgress:_,onSuccess:p,onError:m})=>{},handleUploadChange:l=>{l.file.status==="uploading"&&(u.value="uploading")},submitForm:async()=>{var _,p;if(!s.value){y.warning("请先上传音频文件");return}const l=new FormData;l.append("voice_file",s.value),e.name&&l.append("name",e.name),e.tags&&e.tags.length>0&&l.append("tags",e.tags.join(",")),e.gender&&l.append("gender",e.gender),e.age_group&&l.append("age_group",e.age_group),e.description&&l.append("description",e.description),u.value="uploading",i.value=0;try{const m=await D.post("/api/voices/extract",l,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:b=>{const O=Math.round(b.loaded*100/b.total);i.value=O}});u.value="extracting",m.data&&m.data.success?(u.value="success",y.success("声纹特征提取成功！")):(u.value="error",c.value=m.data.message||"未知错误",y.error("声纹特征提取失败: "+c.value))}catch(m){u.value="error",c.value=((p=(_=m.response)==null?void 0:_.data)==null?void 0:p.message)||m.message||"未知错误",y.error("声纹特征提取失败: "+c.value)}},resetForm:()=>{e.name="",e.tags=[],e.gender=void 0,e.age_group=void 0,e.description="",s.value=null,u.value="idle",i.value=0,c.value=""},goToVoiceList:()=>{a.push("/voice-list")}}}}),Y={class:"voice-feature-container"},Z={class:"ant-upload-drag-icon"},K={key:0},h={key:1},x={key:2},ee={key:3};function ae(a,e,s,u,i,c){const V=r("a-page-header"),M=r("inbox-outlined"),P=r("a-upload-dragger"),w=r("a-divider"),A=r("a-input"),v=r("a-form-item"),U=r("a-select"),g=r("a-select-option"),l=r("a-textarea"),_=r("cloud-upload-outlined"),p=r("a-button"),m=r("a-form"),b=r("a-card"),O=r("a-col"),L=r("a-progress"),j=r("a-result"),T=r("a-row");return C(),S("div",Y,[t(V,{title:"声纹特征提取","sub-title":"上传音频提取声纹特征，用于自定义音色合成"}),t(T,{gutter:24},{default:o(()=>[t(O,{span:16},{default:o(()=>[t(b,{title:"声纹特征提取",class:"extract-card"},{default:o(()=>[t(P,{name:"voice_file",multiple:!1,action:"/api/voices/extract",headers:a.uploadHeaders,"before-upload":a.beforeUpload,"custom-request":a.customUploadRequest,onChange:a.handleUploadChange,accept:".wav,.mp3,.flac"},{default:o(()=>[n("p",Z,[t(M)]),e[5]||(e[5]=n("p",{class:"ant-upload-text"},"点击或拖拽音频文件到此区域",-1)),e[6]||(e[6]=n("p",{class:"ant-upload-hint"},[d(" 支持WAV、MP3、FLAC格式，建议5-10秒高质量录音"),n("br"),d(" 上传的音频将用于提取声纹特征，以便生成相似的语音 ")],-1))]),_:1,__:[5,6]},8,["headers","before-upload","custom-request","onChange"]),t(w),t(m,{model:a.formState,name:"voiceFeatureForm",layout:"vertical",disabled:a.uploadStatus==="uploading"},{default:o(()=>[t(v,{label:"声音名称",name:"name",rules:[{required:!0,message:"请输入声音名称"}]},{default:o(()=>[t(A,{value:a.formState.name,"onUpdate:value":e[0]||(e[0]=f=>a.formState.name=f),placeholder:"给这个声音起个名字","allow-clear":""},null,8,["value"])]),_:1}),t(v,{label:"声音标签",name:"tags"},{default:o(()=>[t(U,{value:a.formState.tags,"onUpdate:value":e[1]||(e[1]=f=>a.formState.tags=f),mode:"tags",placeholder:"添加标签",options:a.tagOptions,"allow-clear":""},null,8,["value","options"])]),_:1}),t(v,{label:"性别",name:"gender"},{default:o(()=>[t(U,{value:a.formState.gender,"onUpdate:value":e[2]||(e[2]=f=>a.formState.gender=f),placeholder:"选择性别","allow-clear":""},{default:o(()=>[t(g,{value:"male"},{default:o(()=>e[7]||(e[7]=[d("男性")])),_:1,__:[7]}),t(g,{value:"female"},{default:o(()=>e[8]||(e[8]=[d("女性")])),_:1,__:[8]}),t(g,{value:"other"},{default:o(()=>e[9]||(e[9]=[d("其他")])),_:1,__:[9]})]),_:1},8,["value"])]),_:1}),t(v,{label:"年龄段",name:"age_group"},{default:o(()=>[t(U,{value:a.formState.age_group,"onUpdate:value":e[3]||(e[3]=f=>a.formState.age_group=f),placeholder:"选择年龄段","allow-clear":""},{default:o(()=>[t(g,{value:"child"},{default:o(()=>e[10]||(e[10]=[d("儿童")])),_:1,__:[10]}),t(g,{value:"young"},{default:o(()=>e[11]||(e[11]=[d("青年")])),_:1,__:[11]}),t(g,{value:"middle"},{default:o(()=>e[12]||(e[12]=[d("中年")])),_:1,__:[12]}),t(g,{value:"old"},{default:o(()=>e[13]||(e[13]=[d("老年")])),_:1,__:[13]})]),_:1},8,["value"])]),_:1}),t(v,{label:"声音描述",name:"description"},{default:o(()=>[t(l,{value:a.formState.description,"onUpdate:value":e[4]||(e[4]=f=>a.formState.description=f),placeholder:"描述这个声音的特点",rows:4,"allow-clear":""},null,8,["value"])]),_:1}),t(v,null,{default:o(()=>[t(p,{type:"primary",loading:a.uploadStatus==="uploading",disabled:!a.audioFile,onClick:a.submitForm,block:""},{icon:o(()=>[t(_)]),default:o(()=>[e[14]||(e[14]=d(" 提取声纹特征 "))]),_:1,__:[14]},8,["loading","disabled","onClick"])]),_:1})]),_:1},8,["model","disabled"])]),_:1})]),_:1}),t(O,{span:8},{default:o(()=>[t(b,{title:"提取说明",class:"help-card"},{default:o(()=>[e[15]||(e[15]=n("p",null,[n("strong",null,"什么是声纹特征？")],-1)),e[16]||(e[16]=n("p",null,"声纹特征是从音频中提取的用于表示说话者独特声音特点的数据。MegaTTS3可以使用这些特征生成与原始声音相似的语音。",-1)),t(w),e[17]||(e[17]=n("p",null,[n("strong",null,"如何获得好的声纹特征？")],-1)),e[18]||(e[18]=n("ul",null,[n("li",null,"选择5-10秒的高质量录音，避免背景噪音"),n("li",null,"使用清晰的语音，避免太多情感起伏"),n("li",null,"尽量使用标准普通话，避免方言"),n("li",null,"确保音频采样率至少为16kHz")],-1)),t(w),e[19]||(e[19]=n("p",null,[n("strong",null,"提取后如何使用？")],-1)),e[20]||(e[20]=n("p",null,'提取完成后，您可以在"声音库"中找到这个声音，并将其分配给小说角色，或直接在文本转语音中使用。',-1))]),_:1,__:[15,16,17,18,19,20]}),a.uploadStatus!=="idle"?(C(),R(b,{key:0,title:"提取进度",class:"progress-card"},{default:o(()=>[a.uploadStatus==="uploading"?(C(),S("div",K,[t(L,{percent:a.uploadProgress,status:"active"},null,8,["percent"]),e[21]||(e[21]=n("p",null,"正在上传音频文件...",-1))])):a.uploadStatus==="extracting"?(C(),S("div",h,[t(L,{percent:100,status:"active"}),e[22]||(e[22]=n("p",null,"正在提取声纹特征，这可能需要几秒钟...",-1))])):a.uploadStatus==="success"?(C(),S("div",x,[t(j,{status:"success",title:"声纹特征提取成功！","sub-title":"您的声音已添加到声音库"},{extra:o(()=>[t(p,{type:"primary",onClick:a.goToVoiceList},{default:o(()=>e[23]||(e[23]=[d(" 查看声音库 ")])),_:1,__:[23]},8,["onClick"]),t(p,{onClick:a.resetForm},{default:o(()=>e[24]||(e[24]=[d(" 继续添加 ")])),_:1,__:[24]},8,["onClick"])]),_:1})])):a.uploadStatus==="error"?(C(),S("div",ee,[t(j,{status:"error",title:"提取失败","sub-title":a.errorMessage},{extra:o(()=>[t(p,{type:"primary",onClick:a.resetForm},{default:o(()=>e[25]||(e[25]=[d(" 重试 ")])),_:1,__:[25]},8,["onClick"])]),_:1},8,["sub-title"])])):q("",!0)]),_:1})):q("",!0)]),_:1})]),_:1})])}const ne=B(X,[["render",ae],["__scopeId","data-v-fda0306a"]]);export{ne as default};
