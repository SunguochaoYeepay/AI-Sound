import{I as o}from"./index-827e089e.js";import{a as n}from"./axios-3a665b0f.js";const r=n.create({baseURL:{}.VITE_API_BASE_URL||"http://localhost:9930",timeout:3e4,headers:{"Content-Type":"application/json",Accept:"application/json"}}),c=o({id:"api",state:()=>({baseUrl:{}.VITE_API_BASE_URL||"http://localhost:9930",apiStatus:!1,apiVersion:"",errorMessage:"",isLoading:!1}),actions:{async checkHealth(){this.isLoading=!0;try{const t=await r.get("/health");return this.apiStatus=!0,this.errorMessage="",{status:"ok",info:{version:t.data.version||"1.0.0",uptime:t.data.uptime||0}}}catch(t){return this.apiStatus=!1,this.errorMessage="无法连接到API服务",console.error("API健康检查失败",t),{status:"error"}}finally{this.isLoading=!1}},async getSystemInfo(){this.isLoading=!0;try{return(await r.get("/api/system/info")).data}catch(t){return console.error("获取系统信息失败",t),{gpu_available:!1,gpu_info:"未知",storage_used:"未知",storage_available:"未知"}}finally{this.isLoading=!1}},async getStats(){this.isLoading=!0;try{return(await r.get("/api/stats")).data}catch(t){return console.error("获取统计数据失败",t),{tts_count:0,novel_count:0,pending_tasks:0,audio_count:0}}finally{this.isLoading=!1}},async getRecentTasks(t=5){this.isLoading=!0;try{return(await r.get(`/api/tasks?limit=${t}`)).data.tasks||[]}catch(e){return console.error("获取最近任务失败",e),[]}finally{this.isLoading=!1}},async getTaskDetails(t){this.isLoading=!0;try{return(await r.get(`/api/tasks/${t}`)).data}catch(e){return console.error(`获取任务详情失败: ${t}`,e),null}finally{this.isLoading=!1}},async uploadNovel(t,e={}){this.isLoading=!0;const s=new FormData;s.append("file",t),Object.keys(e).forEach(a=>{s.append(a,e[a])});try{return(await r.post("/api/novels/upload",s,{headers:{"Content-Type":"multipart/form-data"}})).data}catch(a){throw console.error("上传小说失败",a),a}finally{this.isLoading=!1}},async processNovel(t,e={}){this.isLoading=!0;try{return(await r.post("/api/tts/novel",{novel_path:t,...e})).data}catch(s){throw console.error("小说处理请求失败",s),s}finally{this.isLoading=!1}},async textToSpeech(t,e={}){this.isLoading=!0;try{return(await r.post("/api/tts",{text:t,...e})).data}catch(s){throw console.error("文本转语音失败",s),s}finally{this.isLoading=!1}},async textToSpeechMultipart(t){this.isLoading=!0;try{return(await r.post("/api/tts/text_multipart",t,{headers:{"Content-Type":"multipart/form-data"}})).data}catch(e){throw console.error("文本转语音失败",e),e}finally{this.isLoading=!1}},async getNovels(){this.isLoading=!0;try{return(await r.get("/api/novels")).data.novels||[]}catch(t){return console.error("获取小说列表失败",t),[]}finally{this.isLoading=!1}},async getNovelDetails(t){this.isLoading=!0;try{return(await r.get(`/api/novels/${t}`)).data}catch(e){return console.error(`获取小说详情失败: ${t}`,e),null}finally{this.isLoading=!1}},async deleteNovel(t){this.isLoading=!0;try{return(await r.delete(`/api/novels/${t}`)).data}catch(e){throw console.error(`删除小说失败: ${t}`,e),e}finally{this.isLoading=!1}},async getNovelChapters(t){this.isLoading=!0;try{return(await r.get(`/api/novels/${t}/chapters`)).data.chapters||[]}catch(e){return console.error(`获取小说章节失败: ${t}`,e),[]}finally{this.isLoading=!1}},async getChapterContent(t,e){this.isLoading=!0;try{return(await r.get(`/api/novels/${t}/chapters/${e}`)).data}catch(s){return console.error(`获取章节内容失败: ${t}/${e}`,s),null}finally{this.isLoading=!1}},async updateNovelConfig(t,e){this.isLoading=!0;try{return(await r.put(`/api/novels/${t}/config`,e)).data}catch(s){throw console.error(`更新小说配置失败: ${t}`,s),s}finally{this.isLoading=!1}},async getAllTasks(){this.isLoading=!0;try{return(await r.get("/api/tasks")).data}catch(t){return console.error("获取所有任务失败",t),{tasks:[]}}finally{this.isLoading=!1}},async importNovelFromUrl(t,e={}){this.isLoading=!0;try{return(await r.post("/api/novels/import",{url:t,...e})).data}catch(s){throw console.error("导入小说失败",s),s}finally{this.isLoading=!1}},async getCharacterMappings(){this.isLoading=!0;try{return(await r.get("/api/characters")).data.characters||[]}catch(t){return console.error("获取角色声音映射失败",t),[]}finally{this.isLoading=!1}}}});export{c as u};
