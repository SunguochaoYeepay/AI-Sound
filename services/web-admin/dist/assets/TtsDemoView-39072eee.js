import{u as H}from"./api-d479bee2.js";import{P as E,u as q}from"./wavesurfer.esm-c46e585e.js";import{P as J}from"./PageHeader-2fef59b0.js";import{c as a,A as Q,_ as X,d as Y,S as Z,D as K,r as y,a as x,o as ee,b as te,h as ae,e as N,f as V,w as l,m as A,g as d,i,j as c,t as D,k as le}from"./index-827e089e.js";import{U as oe}from"./UploadOutlined-3141d868.js";import"./axios-3a665b0f.js";var ne={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}},{tag:"path",attrs:{d:"M719.4 499.1l-296.1-215A15.9 15.9 0 00398 297v430c0 13.1 14.8 20.5 25.3 12.9l296.1-215a15.9 15.9 0 000-25.8zm-257.6 134V390.9L628.5 512 461.8 633.1z"}}]},name:"play-circle",theme:"outlined"};const se=ne;function z(t){for(var e=1;e<arguments.length;e++){var s=arguments[e]!=null?Object(arguments[e]):{},_=Object.keys(s);typeof Object.getOwnPropertySymbols=="function"&&(_=_.concat(Object.getOwnPropertySymbols(s).filter(function(n){return Object.getOwnPropertyDescriptor(s,n).enumerable}))),_.forEach(function(n){ie(t,n,s[n])})}return t}function ie(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}var B=function(e,s){var _=z({},e,s.attrs);return a(Q,z({},_,{icon:se}),null)};B.displayName="PlayCircleOutlined";B.inheritAttrs=!1;const W=B;const re=Y({name:"TtsDemoView",components:{PageHeader:J,SoundOutlined:Z,PlayCircleOutlined:W,PauseOutlined:E,DownloadOutlined:K,UploadOutlined:oe},setup(){const t=H(),e=y(null),s=y(null),_=y(null),n=x({text:"你好，我是MegaTTS3语音合成系统，很高兴为您服务！",voiceId:"female_young",emotionType:"neutral",emotionIntensity:.5,speedScale:1,pitchScale:1,p_w:1,t_w:1}),m=y(""),w=y(""),O=y(0),f=y(!1),p=y(!1),g=y(null),v=y(""),C=o=>{const u=o.target.files[0];u?(g.value=u,v.value=u.name):(g.value=null,v.value="")},S=()=>{_.value&&_.value.click()},P=()=>{s.value&&s.value.destroy(),s.value=q.create({container:e.value,waveColor:"#409EFF",progressColor:"#1890ff",cursorColor:"#f5222d",barWidth:2,barRadius:3,cursorWidth:1,height:80,barGap:2}),s.value.on("play",()=>{f.value=!0}),s.value.on("pause",()=>{f.value=!1}),s.value.on("finish",()=>{f.value=!1})},b=async()=>{if(!n.text.trim()){A.warning("请输入要转换的文本");return}p.value=!0;try{const o=new FormData;o.append("text",n.text),o.append("voice_id",n.voiceId),o.append("emotion_type",n.emotionType),o.append("emotion_intensity",n.emotionIntensity),o.append("speed_scale",n.speedScale),o.append("pitch_scale",n.pitchScale),o.append("p_w",n.p_w),o.append("t_w",n.t_w),o.append("return_base64",!0),g.value&&o.append("voice_file",g.value);const u=await t.textToSpeechMultipart(o);if(u&&u.audio_base64){if(w.value=u.audio_base64,O.value=u.duration||1,w.value){const k=I(w.value,"audio/wav");m.value&&URL.revokeObjectURL(m.value),m.value=URL.createObjectURL(k),setTimeout(()=>{P(),s.value.load(m.value)},100)}A.success("语音生成成功")}else A.error((u==null?void 0:u.message)||"语音生成失败")}catch(o){A.error("语音生成请求失败: "+(o.message||"未知错误")),console.error("语音生成错误",o)}finally{p.value=!1}},I=(o,u)=>{const k=atob(o),L=[];for(let F=0;F<k.length;F+=512){const j=k.slice(F,F+512),$=new Array(j.length);for(let T=0;T<j.length;T++)$[T]=j.charCodeAt(T);const G=new Uint8Array($);L.push(G)}return new Blob(L,{type:u})},R=()=>{s.value&&s.value.playPause()},U=()=>{if(m.value){const o=document.createElement("a");o.href=m.value,o.download=`tts_demo_${new Date().getTime()}.wav`,document.body.appendChild(o),o.click(),document.body.removeChild(o)}},M=()=>{n.text="你好，我是MegaTTS3语音合成系统，很高兴为您服务！",n.voiceId="female_young",n.emotionType="neutral",n.emotionIntensity=.5,n.speedScale=1,n.pitchScale=1,n.p_w=1,n.t_w=1},h=o=>({female_young:"年轻女声",female_mature:"成熟女声",male_young:"年轻男声",male_middle:"中年男声",male_elder:"老年男声"})[o]||o,r=o=>({neutral:"中性",happy:"开心",sad:"悲伤",angry:"愤怒",surprised:"惊讶"})[o]||o;return ee(()=>{m.value&&(P(),s.value.load(m.value))}),te(()=>{s.value&&s.value.destroy(),m.value&&URL.revokeObjectURL(m.value)}),{waveformRef:e,formState:n,audioUrl:m,audioDuration:O,isPlaying:f,processing:p,generateSpeech:b,togglePlay:R,downloadAudio:U,resetForm:M,getVoiceName:h,getEmotionName:r,h:ae,PlayCircleOutlined:W,PauseOutlined:E,voiceFile:g,voiceFileName:v,onVoiceFileChange:C,voiceFileRef:_,triggerFileUpload:S}}}),ue={class:"tts-demo"},de={class:"upload-box"},pe=["disabled"],fe={key:0,class:"file-name"},me={key:0,class:"empty-player"},ve={key:1,class:"audio-player"},ce={ref:"waveformRef",class:"waveform"},_e={class:"audio-controls"},ye={class:"audio-info"};function ge(t,e,s,_,n,m){const w=d("page-header"),O=d("a-textarea"),f=d("a-form-item"),p=d("a-select-option"),g=d("a-select"),v=d("a-col"),C=d("a-slider"),S=d("a-row"),P=d("upload-outlined"),b=d("a-button"),I=d("a-space"),R=d("a-form"),U=d("a-card"),M=d("sound-outlined"),h=d("download-outlined");return N(),V("div",ue,[a(w,{title:"语音试听",subtitle:"测试不同音色和参数效果"}),a(S,{gutter:16},{default:l(()=>[a(v,{span:16},{default:l(()=>[a(U,{title:"文本输入"},{default:l(()=>[a(R,{model:t.formState,layout:"vertical"},{default:l(()=>[a(f,{label:"输入文本"},{default:l(()=>[a(O,{value:t.formState.text,"onUpdate:value":e[0]||(e[0]=r=>t.formState.text=r),placeholder:"请输入要转换的文本内容，如：你好，世界！",rows:6,disabled:t.processing},null,8,["value","disabled"])]),_:1}),a(S,{gutter:16},{default:l(()=>[a(v,{span:8},{default:l(()=>[a(f,{label:"音色选择"},{default:l(()=>[a(g,{value:t.formState.voiceId,"onUpdate:value":e[1]||(e[1]=r=>t.formState.voiceId=r),placeholder:"选择音色",disabled:t.processing},{default:l(()=>[a(p,{value:"female_young"},{default:l(()=>e[7]||(e[7]=[i("年轻女声")])),_:1,__:[7]}),a(p,{value:"female_mature"},{default:l(()=>e[8]||(e[8]=[i("成熟女声")])),_:1,__:[8]}),a(p,{value:"male_young"},{default:l(()=>e[9]||(e[9]=[i("年轻男声")])),_:1,__:[9]}),a(p,{value:"male_middle"},{default:l(()=>e[10]||(e[10]=[i("中年男声")])),_:1,__:[10]}),a(p,{value:"male_elder"},{default:l(()=>e[11]||(e[11]=[i("老年男声")])),_:1,__:[11]})]),_:1},8,["value","disabled"])]),_:1})]),_:1}),a(v,{span:8},{default:l(()=>[a(f,{label:"情感类型"},{default:l(()=>[a(g,{value:t.formState.emotionType,"onUpdate:value":e[2]||(e[2]=r=>t.formState.emotionType=r),placeholder:"选择情感类型",disabled:t.processing},{default:l(()=>[a(p,{value:"neutral"},{default:l(()=>e[12]||(e[12]=[i("中性")])),_:1,__:[12]}),a(p,{value:"happy"},{default:l(()=>e[13]||(e[13]=[i("开心")])),_:1,__:[13]}),a(p,{value:"sad"},{default:l(()=>e[14]||(e[14]=[i("悲伤")])),_:1,__:[14]}),a(p,{value:"angry"},{default:l(()=>e[15]||(e[15]=[i("愤怒")])),_:1,__:[15]}),a(p,{value:"surprised"},{default:l(()=>e[16]||(e[16]=[i("惊讶")])),_:1,__:[16]})]),_:1},8,["value","disabled"])]),_:1})]),_:1}),a(v,{span:8},{default:l(()=>[a(f,{label:"情感强度"},{default:l(()=>[a(C,{value:t.formState.emotionIntensity,"onUpdate:value":e[3]||(e[3]=r=>t.formState.emotionIntensity=r),min:0,max:1,step:.1,disabled:t.processing},null,8,["value","disabled"])]),_:1})]),_:1})]),_:1}),a(S,{gutter:16},{default:l(()=>[a(v,{span:12},{default:l(()=>[a(f,{label:"语速调节"},{default:l(()=>[a(C,{value:t.formState.speedScale,"onUpdate:value":e[4]||(e[4]=r=>t.formState.speedScale=r),min:.5,max:2,step:.1,disabled:t.processing},null,8,["value","disabled"])]),_:1})]),_:1}),a(v,{span:12},{default:l(()=>[a(f,{label:"音调调节"},{default:l(()=>[a(C,{value:t.formState.pitchScale,"onUpdate:value":e[5]||(e[5]=r=>t.formState.pitchScale=r),min:.5,max:2,step:.1,disabled:t.processing},null,8,["value","disabled"])]),_:1})]),_:1})]),_:1}),a(S,{gutter:16},{default:l(()=>[a(v,{span:8},{default:l(()=>[a(f,{label:"声音参考文件(可选)"},{default:l(()=>[c("div",de,[c("input",{type:"file",accept:"audio/*",onChange:e[6]||(e[6]=(...r)=>t.onVoiceFileChange&&t.onVoiceFileChange(...r)),ref:"voiceFileRef",style:{display:"none"},disabled:t.processing},null,40,pe),a(b,{type:"dashed",onClick:t.triggerFileUpload,style:{width:"100%"},disabled:t.processing},{default:l(()=>[a(P),e[17]||(e[17]=i(" 上传声音文件 "))]),_:1,__:[17]},8,["onClick","disabled"]),t.voiceFileName?(N(),V("span",fe,D(t.voiceFileName),1)):le("",!0)])]),_:1})]),_:1})]),_:1}),a(f,null,{default:l(()=>[a(I,null,{default:l(()=>[a(b,{type:"primary",onClick:t.generateSpeech,loading:t.processing},{default:l(()=>e[18]||(e[18]=[i(" 生成语音 ")])),_:1,__:[18]},8,["onClick","loading"]),a(b,{onClick:t.resetForm,disabled:t.processing},{default:l(()=>e[19]||(e[19]=[i("重置")])),_:1,__:[19]},8,["onClick","disabled"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1}),a(v,{span:8},{default:l(()=>[a(U,{title:"语音试听"},{default:l(()=>[t.audioUrl?(N(),V("div",ve,[c("div",ce,null,512),c("div",_e,[a(b,{type:"primary",shape:"circle",icon:t.isPlaying?t.h(t.PauseOutlined):t.h(t.PlayCircleOutlined),onClick:t.togglePlay},null,8,["icon","onClick"]),a(b,{type:"link",onClick:t.downloadAudio},{default:l(()=>[a(h),e[21]||(e[21]=i(" 下载音频 "))]),_:1,__:[21]},8,["onClick"])]),c("div",ye,[c("p",null,[e[22]||(e[22]=c("strong",null,"时长:",-1)),i(" "+D(t.audioDuration.toFixed(2))+"秒",1)]),c("p",null,[e[23]||(e[23]=c("strong",null,"音色:",-1)),i(" "+D(t.getVoiceName(t.formState.voiceId)),1)]),c("p",null,[e[24]||(e[24]=c("strong",null,"情感:",-1)),i(" "+D(t.getEmotionName(t.formState.emotionType)),1)])])])):(N(),V("div",me,[a(M,{style:{fontSize:"64px",color:"#d9d9d9"}}),e[20]||(e[20]=c("p",null,"生成语音后将在此处播放",-1))]))]),_:1})]),_:1})]),_:1})])}const Ue=X(re,[["render",ge],["__scopeId","data-v-f9c1b482"]]);export{Ue as default};
