import{c as n,A as Z,_ as oe,d as re,P as ie,S as se,J as ue,H as de,q as pe,r as m,a as ve,B as ce,o as fe,C as me,e as _,f as j,w as l,m as g,K as ge,M as _e,g as u,i as d,v as X,x as Y,p as C,j as y,t as S,k as te}from"./index-827e089e.js";import{a as T}from"./axios-3a665b0f.js";import{P as be,u as ye}from"./wavesurfer.esm-c46e585e.js";var we={icon:{tag:"svg",attrs:{viewBox:"0 0 1024 1024",focusable:"false"},children:[{tag:"path",attrs:{d:"M715.8 493.5L335 165.1c-14.2-12.2-35-1.2-35 18.5v656.8c0 19.7 20.8 30.7 35 18.5l380.8-328.4c10.9-9.4 10.9-27.6 0-37z"}}]},name:"caret-right",theme:"outlined"};const Oe=we;function ae(t){for(var e=1;e<arguments.length;e++){var o=arguments[e]!=null?Object(arguments[e]):{},p=Object.keys(o);typeof Object.getOwnPropertySymbols=="function"&&(p=p.concat(Object.getOwnPropertySymbols(o).filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable}))),p.forEach(function(c){Ce(t,c,o[c])})}return t}function Ce(t,e,o){return e in t?Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[e]=o,t}var K=function(e,o){var p=ae({},e,o.attrs);return n(Z,ae({},p,{icon:Oe}),null)};K.displayName="CaretRightOutlined";K.inheritAttrs=!1;const Ve=K;var ke={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M456 231a56 56 0 10112 0 56 56 0 10-112 0zm0 280a56 56 0 10112 0 56 56 0 10-112 0zm0 280a56 56 0 10112 0 56 56 0 10-112 0z"}}]},name:"more",theme:"outlined"};const Pe=ke;function ne(t){for(var e=1;e<arguments.length;e++){var o=arguments[e]!=null?Object(arguments[e]):{},p=Object.keys(o);typeof Object.getOwnPropertySymbols=="function"&&(p=p.concat(Object.getOwnPropertySymbols(o).filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable}))),p.forEach(function(c){he(t,c,o[c])})}return t}function he(t,e,o){return e in t?Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[e]=o,t}var x=function(e,o){var p=ne({},e,o.attrs);return n(Z,ne({},p,{icon:Pe}),null)};x.displayName="MoreOutlined";x.inheritAttrs=!1;const Fe=x;var Se={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h360c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H184V184h656v320c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8V144c0-17.7-14.3-32-32-32zM653.3 599.4l52.2-52.2a8.01 8.01 0 00-4.7-13.6l-179.4-21c-5.1-.6-9.5 3.7-8.9 8.9l21 179.4c.8 6.6 8.9 9.4 13.6 4.7l52.4-52.4 256.2 256.2c3.1 3.1 8.2 3.1 11.3 0l42.4-42.4c3.1-3.1 3.1-8.2 0-11.3L653.3 599.4z"}}]},name:"select",theme:"outlined"};const $e=Se;function le(t){for(var e=1;e<arguments.length;e++){var o=arguments[e]!=null?Object(arguments[e]):{},p=Object.keys(o);typeof Object.getOwnPropertySymbols=="function"&&(p=p.concat(Object.getOwnPropertySymbols(o).filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable}))),p.forEach(function(c){Me(t,c,o[c])})}return t}function Me(t,e,o){return e in t?Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[e]=o,t}var ee=function(e,o){var p=le({},e,o.attrs);return n(Z,le({},p,{icon:$e}),null)};ee.displayName="SelectOutlined";ee.inheritAttrs=!1;const Le=ee;const Ue=re({name:"VoiceListView",components:{PlusOutlined:ie,SoundOutlined:se,EditOutlined:ue,DeleteOutlined:de,MoreOutlined:Fe,CaretRightOutlined:Ve,PauseOutlined:be,SelectOutlined:Le},setup(){const t=pe(),e=m(!0),o=m([]),p=m(""),c=m(void 0),A=m(void 0),$=m(void 0),w=m(!1),h=m(null),M=m("这是一段用于测试声音的文本，可以听听效果如何？"),O=m(null),i=m(null),b=m(!1),V=m(!1),L=m(!1),k=m(!1),P=m(!1),v=ve({id:"",name:"",gender:void 0,age_group:void 0,tags:[],description:""}),U=[{value:"male",label:"男性"},{value:"female",label:"女性"},{value:"young",label:"年轻"},{value:"mature",label:"成熟"},{value:"clear",label:"清晰"},{value:"deep",label:"低沉"},{value:"soft",label:"柔和"},{value:"energetic",label:"有活力"}],B=ce(()=>o.value.filter(r=>!(p.value&&!r.name.toLowerCase().includes(p.value.toLowerCase())&&!r.tags.some(f=>f.toLowerCase().includes(p.value.toLowerCase()))||c.value&&r.attributes.gender!==c.value||A.value&&r.attributes.age_group!==A.value||$.value&&!r.tags.includes($.value)))),D=async()=>{var r,f;e.value=!0;try{const a=await T.get("/api/voices/list");a.data&&a.data.success?o.value=a.data.voices||[]:g.error("获取声音列表失败: "+(a.data.message||"未知错误"))}catch(a){g.error("获取声音列表失败: "+(((f=(r=a.response)==null?void 0:r.data)==null?void 0:f.message)||a.message||"未知错误"))}finally{e.value=!1}},N=r=>{p.value=r},E=()=>{},q=async r=>{var f,a;h.value=r,w.value=!0,V.value=!1,await ge(),i.value&&i.value.destroy(),i.value=ye.create({container:O.value,waveColor:"#4096ff",progressColor:"#1677ff",cursorColor:"#999",height:80,responsive:!0,normalize:!0}),i.value.on("ready",()=>{V.value=!0}),i.value.on("play",()=>{b.value=!0}),i.value.on("pause",()=>{b.value=!1}),i.value.on("finish",()=>{b.value=!1});try{const s=await T.get(`/api/voices/${r.id}/preview`);if(s.data&&s.data.success){const F=s.data.audio_url||s.data.audio_base64;F?i.value.load(F):g.warning("没有可用的预览音频")}else g.error("获取预览音频失败: "+(s.data.message||"未知错误"))}catch(s){g.error("获取预览音频失败: "+(((a=(f=s.response)==null?void 0:f.data)==null?void 0:a.message)||s.message||"未知错误"))}},H=()=>{i.value&&i.value.playPause()},I=()=>{i.value&&b.value&&i.value.pause()},J=async()=>{var r,f;if(!h.value||!M.value.trim()){g.warning("请输入要试听的文本");return}L.value=!0;try{const a=await T.post("/api/tts/text",{text:M.value,voice_id:h.value.id});if(a.data&&a.data.success){const s=a.data.audio_url||a.data.audio_base64;s?i.value&&(i.value.pause(),i.value.load(s),i.value.on("ready",()=>{i.value.play()})):g.warning("生成的音频无法播放")}else g.error("生成预览音频失败: "+(a.data.message||"未知错误"))}catch(a){g.error("生成预览音频失败: "+(((f=(r=a.response)==null?void 0:r.data)==null?void 0:f.message)||a.message||"未知错误"))}finally{L.value=!1}},G=r=>{v.id=r.id,v.name=r.name,v.gender=r.attributes.gender,v.age_group=r.attributes.age_group,v.tags=[...r.tags],v.description=r.description,k.value=!0},Q=async()=>{var r,f;if(!v.name.trim()){g.warning("声音名称不能为空");return}P.value=!0;try{const a=await T.put(`/api/voices/${v.id}`,{name:v.name,attributes:{gender:v.gender,age_group:v.age_group},tags:v.tags,description:v.description});if(a.data&&a.data.success){g.success("声音信息更新成功"),k.value=!1;const s=o.value.findIndex(F=>F.id===v.id);s!==-1&&(o.value[s]={...o.value[s],name:v.name,attributes:{...o.value[s].attributes,gender:v.gender,age_group:v.age_group},tags:[...v.tags],description:v.description})}else g.error("更新声音信息失败: "+(a.data.message||"未知错误"))}catch(a){g.error("更新声音信息失败: "+(((f=(r=a.response)==null?void 0:r.data)==null?void 0:f.message)||a.message||"未知错误"))}finally{P.value=!1}},R=r=>{_e.confirm({title:"确认删除",content:`确定要删除声音"${r.name}"吗？此操作不可恢复。`,okText:"删除",okType:"danger",cancelText:"取消",async onOk(){var f,a;try{const s=await T.delete(`/api/voices/${r.id}`);s.data&&s.data.success?(g.success("声音已删除"),o.value=o.value.filter(F=>F.id!==r.id)):g.error("删除声音失败: "+(s.data.message||"未知错误"))}catch(s){g.error("删除声音失败: "+(((a=(f=s.response)==null?void 0:f.data)==null?void 0:a.message)||s.message||"未知错误"))}}})},z=r=>{t.push({path:"/tts",query:{voice_id:r.id}})},W=()=>{t.push("/voice-feature")};return fe(()=>{D()}),me(()=>{i.value&&i.value.destroy()}),{loading:e,voiceList:o,filteredVoiceList:B,searchKeyword:p,genderFilter:c,ageFilter:A,tagFilter:$,tagOptions:U,onSearch:N,onFilterChange:E,previewVoice:q,editVoice:G,confirmDeleteVoice:R,useVoice:z,goToVoiceFeature:W,previewModalVisible:w,selectedVoice:h,previewText:M,waveformRef:O,isPlaying:b,previewAudioLoaded:V,generatingPreview:L,togglePreviewAudio:H,stopPreviewAudio:I,generatePreview:J,editModalVisible:k,editForm:v,updating:P,updateVoice:Q}}}),je={class:"voice-list-container"},Te={class:"voice-card-cover"},Ae={class:"voice-card-title"},Re={class:"voice-tags"},ze={class:"voice-description"},Be={class:"voice-controls"},De={key:0},Ne={class:"preview-audio-player"},Ee={id:"waveform",ref:"waveformRef"},qe={class:"audio-controls"},He={class:"preview-text-input"};function Ie(t,e,o,p,c,A){const $=u("plus-outlined"),w=u("a-button"),h=u("a-page-header"),M=u("a-input-search"),O=u("a-col"),i=u("a-select-option"),b=u("a-select"),V=u("a-row"),L=u("a-empty"),k=u("sound-outlined"),P=u("a-tag"),v=u("edit-outlined"),U=u("a-menu-item"),B=u("delete-outlined"),D=u("a-menu"),N=u("more-outlined"),E=u("a-dropdown"),q=u("select-outlined"),H=u("a-card"),I=u("a-spin"),J=u("pause-outlined"),G=u("caret-right-outlined"),Q=u("a-divider"),R=u("a-textarea"),z=u("a-modal"),W=u("a-input"),r=u("a-form-item"),f=u("a-form");return _(),j("div",je,[n(h,{title:"声音库","sub-title":"管理所有声纹特征和音色"},{extra:l(()=>[n(w,{type:"primary",onClick:t.goToVoiceFeature},{icon:l(()=>[n($)]),default:l(()=>[e[12]||(e[12]=d(" 添加声音 "))]),_:1,__:[12]},8,["onClick"])]),_:1}),n(V,{gutter:16,class:"filter-row"},{default:l(()=>[n(O,{span:8},{default:l(()=>[n(M,{value:t.searchKeyword,"onUpdate:value":e[0]||(e[0]=a=>t.searchKeyword=a),placeholder:"搜索声音名称或标签",onSearch:t.onSearch,"allow-clear":"","enter-button":""},null,8,["value","onSearch"])]),_:1}),n(O,{span:6},{default:l(()=>[n(b,{value:t.genderFilter,"onUpdate:value":e[1]||(e[1]=a=>t.genderFilter=a),placeholder:"性别筛选",style:{width:"100%"},"allow-clear":"",onChange:t.onFilterChange},{default:l(()=>[n(i,{value:"male"},{default:l(()=>e[13]||(e[13]=[d("男性")])),_:1,__:[13]}),n(i,{value:"female"},{default:l(()=>e[14]||(e[14]=[d("女性")])),_:1,__:[14]}),n(i,{value:"other"},{default:l(()=>e[15]||(e[15]=[d("其他")])),_:1,__:[15]})]),_:1},8,["value","onChange"])]),_:1}),n(O,{span:6},{default:l(()=>[n(b,{value:t.ageFilter,"onUpdate:value":e[2]||(e[2]=a=>t.ageFilter=a),placeholder:"年龄段筛选",style:{width:"100%"},"allow-clear":"",onChange:t.onFilterChange},{default:l(()=>[n(i,{value:"child"},{default:l(()=>e[16]||(e[16]=[d("儿童")])),_:1,__:[16]}),n(i,{value:"young"},{default:l(()=>e[17]||(e[17]=[d("青年")])),_:1,__:[17]}),n(i,{value:"middle"},{default:l(()=>e[18]||(e[18]=[d("中年")])),_:1,__:[18]}),n(i,{value:"old"},{default:l(()=>e[19]||(e[19]=[d("老年")])),_:1,__:[19]})]),_:1},8,["value","onChange"])]),_:1}),n(O,{span:4},{default:l(()=>[n(b,{value:t.tagFilter,"onUpdate:value":e[3]||(e[3]=a=>t.tagFilter=a),placeholder:"标签筛选",style:{width:"100%"},"allow-clear":"",onChange:t.onFilterChange},{default:l(()=>[(_(!0),j(X,null,Y(t.tagOptions,a=>(_(),C(i,{key:a.value,value:a.value},{default:l(()=>[d(S(a.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","onChange"])]),_:1})]),_:1}),n(V,null,{default:l(()=>[n(O,{span:24},{default:l(()=>[n(I,{spinning:t.loading},{default:l(()=>[t.filteredVoiceList.length===0&&!t.loading?(_(),C(L,{key:0,description:"暂无声音数据"})):(_(),C(V,{key:1,gutter:[16,16]},{default:l(()=>[(_(!0),j(X,null,Y(t.filteredVoiceList,a=>(_(),C(O,{xs:24,sm:12,md:8,lg:6,key:a.id},{default:l(()=>[n(H,{hoverable:"",class:"voice-card"},{cover:l(()=>[y("div",Te,[n(k,{class:"voice-icon"})])]),title:l(()=>[y("div",Ae,[d(S(a.name)+" ",1),a.attributes.gender==="male"?(_(),C(P,{key:0,color:"blue"},{default:l(()=>e[20]||(e[20]=[d("男性")])),_:1,__:[20]})):a.attributes.gender==="female"?(_(),C(P,{key:1,color:"magenta"},{default:l(()=>e[21]||(e[21]=[d("女性")])),_:1,__:[21]})):te("",!0)])]),extra:l(()=>[n(E,null,{overlay:l(()=>[n(D,null,{default:l(()=>[n(U,{key:"edit",onClick:s=>t.editVoice(a)},{default:l(()=>[n(v),e[22]||(e[22]=d(" 编辑 "))]),_:2,__:[22]},1032,["onClick"]),n(U,{key:"preview",onClick:s=>t.previewVoice(a)},{default:l(()=>[n(k),e[23]||(e[23]=d(" 试听 "))]),_:2,__:[23]},1032,["onClick"]),n(U,{key:"delete",onClick:s=>t.confirmDeleteVoice(a)},{default:l(()=>[n(B),e[24]||(e[24]=d(" 删除 "))]),_:2,__:[24]},1032,["onClick"])]),_:2},1024)]),default:l(()=>[n(w,{type:"text"},{default:l(()=>[n(N)]),_:1})]),_:2},1024)]),default:l(()=>[y("div",Re,[(_(!0),j(X,null,Y(a.tags,s=>(_(),C(P,{key:s},{default:l(()=>[d(S(s),1)]),_:2},1024))),128))]),y("div",ze,S(a.description||"暂无描述"),1),y("div",Be,[n(w,{type:"primary",size:"small",onClick:s=>t.previewVoice(a)},{icon:l(()=>[n(k)]),default:l(()=>[e[25]||(e[25]=d(" 试听 "))]),_:2,__:[25]},1032,["onClick"]),n(w,{size:"small",onClick:s=>t.useVoice(a)},{icon:l(()=>[n(q)]),default:l(()=>[e[26]||(e[26]=d(" 使用 "))]),_:2,__:[26]},1032,["onClick"])])]),_:2},1024)]),_:2},1024))),128))]),_:1}))]),_:1},8,["spinning"])]),_:1})]),_:1}),n(z,{visible:t.previewModalVisible,"onUpdate:visible":e[5]||(e[5]=a=>t.previewModalVisible=a),title:"声音预览",footer:null,onCancel:t.stopPreviewAudio},{default:l(()=>[t.selectedVoice?(_(),j("div",De,[y("h3",null,S(t.selectedVoice.name),1),y("p",null,S(t.selectedVoice.description||"暂无描述"),1),y("div",Ne,[y("div",Ee,null,512),y("div",qe,[n(w,{disabled:!t.previewAudioLoaded,onClick:t.togglePreviewAudio,type:"primary",shape:"circle"},{icon:l(()=>[t.isPlaying?(_(),C(J,{key:0})):(_(),C(G,{key:1}))]),_:1},8,["disabled","onClick"])])]),n(Q),y("div",He,[n(R,{value:t.previewText,"onUpdate:value":e[4]||(e[4]=a=>t.previewText=a),placeholder:"输入文本进行试听",rows:3},null,8,["value"]),n(w,{type:"primary",loading:t.generatingPreview,onClick:t.generatePreview,style:{"margin-top":"16px"}},{default:l(()=>e[27]||(e[27]=[d(" 生成预览 ")])),_:1,__:[27]},8,["loading","onClick"])])])):te("",!0)]),_:1},8,["visible","onCancel"]),n(z,{visible:t.editModalVisible,"onUpdate:visible":e[11]||(e[11]=a=>t.editModalVisible=a),title:"编辑声音信息",onOk:t.updateVoice,"confirm-loading":t.updating,okText:"保存",cancelText:"取消"},{default:l(()=>[n(f,{model:t.editForm,layout:"vertical"},{default:l(()=>[n(r,{label:"声音名称",name:"name",rules:[{required:!0,message:"请输入声音名称"}]},{default:l(()=>[n(W,{value:t.editForm.name,"onUpdate:value":e[6]||(e[6]=a=>t.editForm.name=a),placeholder:"声音名称","allow-clear":""},null,8,["value"])]),_:1}),n(r,{label:"性别",name:"gender"},{default:l(()=>[n(b,{value:t.editForm.gender,"onUpdate:value":e[7]||(e[7]=a=>t.editForm.gender=a),placeholder:"选择性别","allow-clear":""},{default:l(()=>[n(i,{value:"male"},{default:l(()=>e[28]||(e[28]=[d("男性")])),_:1,__:[28]}),n(i,{value:"female"},{default:l(()=>e[29]||(e[29]=[d("女性")])),_:1,__:[29]}),n(i,{value:"other"},{default:l(()=>e[30]||(e[30]=[d("其他")])),_:1,__:[30]})]),_:1},8,["value"])]),_:1}),n(r,{label:"年龄段",name:"age_group"},{default:l(()=>[n(b,{value:t.editForm.age_group,"onUpdate:value":e[8]||(e[8]=a=>t.editForm.age_group=a),placeholder:"选择年龄段","allow-clear":""},{default:l(()=>[n(i,{value:"child"},{default:l(()=>e[31]||(e[31]=[d("儿童")])),_:1,__:[31]}),n(i,{value:"young"},{default:l(()=>e[32]||(e[32]=[d("青年")])),_:1,__:[32]}),n(i,{value:"middle"},{default:l(()=>e[33]||(e[33]=[d("中年")])),_:1,__:[33]}),n(i,{value:"old"},{default:l(()=>e[34]||(e[34]=[d("老年")])),_:1,__:[34]})]),_:1},8,["value"])]),_:1}),n(r,{label:"标签",name:"tags"},{default:l(()=>[n(b,{value:t.editForm.tags,"onUpdate:value":e[9]||(e[9]=a=>t.editForm.tags=a),mode:"tags",placeholder:"添加标签",options:t.tagOptions,"allow-clear":""},null,8,["value","options"])]),_:1}),n(r,{label:"声音描述",name:"description"},{default:l(()=>[n(R,{value:t.editForm.description,"onUpdate:value":e[10]||(e[10]=a=>t.editForm.description=a),placeholder:"描述这个声音的特点",rows:4,"allow-clear":""},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","onOk","confirm-loading"])])}const We=oe(Ue,[["render",Ie],["__scopeId","data-v-f25be8ef"]]);export{We as default};
