import{c as o,A as ee,_ as te,d as oe,E as ae,q as ne,r as d,a as le,B as se,o as ie,e as C,f as B,w as n,h as re,g as s,m as u,M as ue,j as h,i as r,k as R,p as Y,t as F,n as de,v as pe,x as ce}from"./index-827e089e.js";import{u as fe}from"./api-d479bee2.js";import{I as me}from"./InboxOutlined-8a5fc653.js";import"./axios-3a665b0f.js";var ve={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M574 665.4a8.03 8.03 0 00-11.3 0L446.5 781.6c-53.8 53.8-144.6 59.5-204 0-59.5-59.5-53.8-150.2 0-204l116.2-116.2c3.1-3.1 3.1-8.2 0-11.3l-39.8-39.8a8.03 8.03 0 00-11.3 0L191.4 526.5c-84.6 84.6-84.6 221.5 0 306s221.5 84.6 306 0l116.2-116.2c3.1-3.1 3.1-8.2 0-11.3L574 665.4zm258.6-474c-84.6-84.6-221.5-84.6-306 0L410.3 307.6a8.03 8.03 0 000 11.3l39.7 39.7c3.1 3.1 8.2 3.1 11.3 0l116.2-116.2c53.8-53.8 144.6-59.5 204 0 59.5 59.5 53.8 150.2 0 204L665.3 562.6a8.03 8.03 0 000 11.3l39.8 39.8c3.1 3.1 8.2 3.1 11.3 0l116.2-116.2c84.5-84.6 84.5-221.5 0-306.1zM610.1 372.3a8.03 8.03 0 00-11.3 0L372.3 598.7a8.03 8.03 0 000 11.3l39.6 39.6c3.1 3.1 8.2 3.1 11.3 0l226.4-226.4c3.1-3.1 3.1-8.2 0-11.3l-39.5-39.6z"}}]},name:"link",theme:"outlined"};const ge=ve;function x(t){for(var e=1;e<arguments.length;e++){var p=arguments[e]!=null?Object(arguments[e]):{},g=Object.keys(p);typeof Object.getOwnPropertySymbols=="function"&&(g=g.concat(Object.getOwnPropertySymbols(p).filter(function(f){return Object.getOwnPropertyDescriptor(p,f).enumerable}))),g.forEach(function(f){_e(t,f,p[f])})}return t}function _e(t,e,p){return e in t?Object.defineProperty(t,e,{value:p,enumerable:!0,configurable:!0,writable:!0}):t[e]=p,t}var Z=function(e,p){var g=x({},e,p.attrs);return o(ee,x({},g,{icon:ge}),null)};Z.displayName="LinkOutlined";Z.inheritAttrs=!1;const ye=Z;const ke=oe({name:"NovelManageView",components:{InboxOutlined:me,DownOutlined:ae,LinkOutlined:ye},setup(){const t=ne(),e=fe(),p=d([]),g=d(!0),f=d(null),$=d(!1),y=d(""),_=d(""),w=d(!1),E=d(!1),k=d(!1),O=d(null),b=d([]),L=d(null),c=d(""),T=d(!1),V=d(!1),v=le({defaultVoice:"female_young",chapterMode:"auto",chapterPattern:"^第.{1,10}[章节]",splitByChapter:!0,useVoiceMapping:!0,detectEmotion:!0}),P=d(null),A=se(()=>c.value?c.value.split(/\n+/).filter(a=>a.trim()):[]),j=[{title:"小说名称",dataIndex:"name",key:"name",ellipsis:!0},{title:"上传时间",dataIndex:"uploadTime",key:"uploadTime"},{title:"文件大小",dataIndex:"size",key:"size",customRender:({text:a})=>z(a)},{title:"状态",dataIndex:"status",key:"status",customRender:({text:a})=>re(s("a-tag"),{color:N(a)},()=>I(a))},{title:"操作",key:"action"}],q=a=>a.type==="text/plain"||a.type==="application/epub+zip"||a.type==="application/pdf"?a.size/1024/1024<100?(f.value=a,!1):(u.error("文件必须小于100MB!"),!1):(u.error("只支持TXT、EPUB或PDF文件!"),!1),X=async()=>{if(!f.value){u.warning("请先选择一个文件");return}$.value=!0;try{const a=await e.uploadNovel(f.value);a&&a.success?(u.success("小说上传成功!"),f.value=null,U()):u.error("上传失败: "+((a==null?void 0:a.message)||"未知错误"))}catch(a){u.error("上传失败: "+(a.message||"未知错误"))}finally{$.value=!1}},M=()=>{f.value=null},G=async()=>{if(!y.value){u.warning("请输入URL");return}w.value=!0;try{const a=await e.importNovelFromUrl(y.value,{title:_.value||void 0});a&&a.success?(u.success("小说导入成功!"),y.value="",_.value="",U()):u.error("导入失败: "+((a==null?void 0:a.message)||"未知错误"))}catch(a){u.error("导入失败: "+(a.message||"未知错误"))}finally{w.value=!1}},H=async a=>{O.value=a,E.value=!0,k.value=!0;try{const l=await e.getNovelChapters(a.id);b.value=l,l.length>0&&S(l[0])}catch(l){u.error("获取小说章节失败: "+(l.message||"未知错误"))}finally{k.value=!1}},S=async a=>{L.value=a,k.value=!0;try{const l=await e.getChapterContent(O.value.id,a.id);l?c.value=l.text||"":c.value="无法加载章节内容"}catch(l){c.value="加载失败: "+(l.message||"未知错误")}finally{k.value=!1}},J=a=>{t.push({path:"/novel",query:{id:a.id}})},K=async a=>{P.value=a.id,k.value=!0;try{const l=await e.getNovelDetails(a.id);l&&l.config&&(v.defaultVoice=l.config.defaultVoice||"female_young",v.chapterMode=l.config.chapterMode||"auto",v.chapterPattern=l.config.chapterPattern||"^第.{1,10}[章节]",v.splitByChapter=l.config.splitByChapter!==!1,v.useVoiceMapping=l.config.useVoiceMapping!==!1,v.detectEmotion=l.config.detectEmotion!==!1),T.value=!0}catch(l){u.error("获取小说配置失败: "+(l.message||"未知错误"))}finally{k.value=!1}},Q=async()=>{if(P.value){V.value=!0;try{const a=await e.updateNovelConfig(P.value,v);a&&a.success?(u.success("配置保存成功"),T.value=!1):u.error("配置保存失败: "+((a==null?void 0:a.message)||"未知错误"))}catch(a){u.error("配置保存失败: "+(a.message||"未知错误"))}finally{V.value=!1}}},W=a=>{ue.confirm({title:"确认删除",content:`确定要删除小说"${a.name}"吗？此操作不可恢复。`,okText:"删除",okType:"danger",cancelText:"取消",onOk:async()=>{try{const l=await e.deleteNovel(a.id);l&&l.success?(u.success("小说已删除"),U()):u.error("删除失败: "+((l==null?void 0:l.message)||"未知错误"))}catch(l){u.error("删除失败: "+(l.message||"未知错误"))}}})},z=a=>{if(!a||a===0)return"0 B";const l=1024,i=["B","KB","MB","GB"],m=Math.floor(Math.log(a)/Math.log(l));return parseFloat((a/Math.pow(l,m)).toFixed(2))+" "+i[m]},N=a=>({pending:"blue",processing:"orange",completed:"green",failed:"red"})[a]||"default",I=a=>({pending:"待处理",processing:"处理中",completed:"已完成",failed:"失败"})[a]||"未知",U=async()=>{g.value=!0;try{const a=await e.getNovels();p.value=a||[]}catch(a){u.error("加载小说列表失败: "+(a.message||"未知错误")),p.value=[]}finally{g.value=!1}};return ie(()=>{U()}),{novels:p,columns:j,loading:g,currentFile:f,uploading:$,beforeUpload:q,uploadNovel:X,cancelUpload:M,viewNovel:H,processNovel:J,editConfig:K,confirmDeleteNovel:W,formatFileSize:z,getStatusColor:N,getStatusText:I,importUrl:y,importTitle:_,importing:w,importFromUrl:G,previewVisible:E,previewLoading:k,currentNovel:O,novelChapters:b,selectedChapter:L,chapterParagraphs:A,selectChapter:S,configVisible:T,configForm:v,savingConfig:V,saveConfig:Q}}}),be={class:"novel-manage"},Ce={class:"ant-upload-drag-icon"},we={key:0,class:"mt-16"},Ne={key:0},he={class:"chapter-title"},Fe={key:0,class:"content-panel"},Me={class:"chapter-header"},Ue={class:"chapter-text"};function Le(t,e,p,g,f,$){const y=s("a-card"),_=s("a-col"),w=s("a-row"),E=s("inbox-outlined"),k=s("a-upload-dragger"),O=s("a-alert"),b=s("a-button"),L=s("a-input"),c=s("a-form-item"),T=s("link-outlined"),V=s("a-form"),v=s("a-menu-item"),P=s("a-menu"),A=s("down-outlined"),j=s("a-dropdown"),q=s("a-space"),X=s("a-table"),M=s("a-descriptions-item"),G=s("a-tag"),H=s("a-descriptions"),S=s("a-divider"),J=s("a-list-item"),K=s("a-list"),Q=s("a-empty"),W=s("a-spin"),z=s("a-modal"),N=s("a-select-option"),I=s("a-select"),U=s("a-radio"),a=s("a-radio-group"),l=s("a-checkbox");return C(),B("div",be,[o(w,{gutter:16,class:"mb-16"},{default:n(()=>[o(_,{span:24},{default:n(()=>[o(y,{title:"小说管理",bordered:!1},{default:n(()=>e[10]||(e[10]=[h("p",null,"上传、配置与处理小说",-1)])),_:1,__:[10]})]),_:1})]),_:1}),o(w,{gutter:16,class:"mb-16"},{default:n(()=>[o(_,{span:12},{default:n(()=>[o(y,{title:"小说上传"},{default:n(()=>[o(k,{name:"file",multiple:!1,"before-upload":t.beforeUpload,"show-upload-list":!1,accept:".txt,.epub,.pdf"},{default:n(()=>[h("p",Ce,[o(E)]),e[11]||(e[11]=h("p",{class:"ant-upload-text"},"点击或拖拽文件到此区域上传",-1)),e[12]||(e[12]=h("p",{class:"ant-upload-hint"}," 支持单个TXT、EPUB或PDF文件，最大100MB ",-1))]),_:1,__:[11,12]},8,["before-upload"]),t.currentFile?(C(),B("div",we,[o(O,{message:`已选择文件: ${t.currentFile.name}`,type:"info","show-icon":"",class:"mb-16"},null,8,["message"]),o(b,{type:"primary",onClick:t.uploadNovel,loading:t.uploading},{default:n(()=>e[13]||(e[13]=[r(" 开始上传 ")])),_:1,__:[13]},8,["onClick","loading"]),o(b,{onClick:t.cancelUpload,class:"ml-2"},{default:n(()=>e[14]||(e[14]=[r(" 取消 ")])),_:1,__:[14]},8,["onClick"])])):R("",!0)]),_:1})]),_:1}),o(_,{span:12},{default:n(()=>[o(y,{title:"从URL导入"},{default:n(()=>[o(V,{layout:"vertical"},{default:n(()=>[o(c,{label:"小说URL",rules:[{required:!0,message:"请输入URL"}]},{default:n(()=>[o(L,{value:t.importUrl,"onUpdate:value":e[0]||(e[0]=i=>t.importUrl=i),placeholder:"输入小说URL（支持常见小说网站）",disabled:t.importing},null,8,["value","disabled"])]),_:1}),o(c,{label:"小说标题（可选）"},{default:n(()=>[o(L,{value:t.importTitle,"onUpdate:value":e[1]||(e[1]=i=>t.importTitle=i),placeholder:"指定标题（留空则自动获取）",disabled:t.importing},null,8,["value","disabled"])]),_:1}),o(c,null,{default:n(()=>[o(b,{type:"primary",onClick:t.importFromUrl,loading:t.importing,disabled:!t.importUrl},{icon:n(()=>[o(T)]),default:n(()=>[e[15]||(e[15]=r(" 开始导入 "))]),_:1,__:[15]},8,["onClick","loading","disabled"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),o(w,{gutter:16},{default:n(()=>[o(_,{span:24},{default:n(()=>[o(y,{title:"小说列表"},{default:n(()=>[o(X,{dataSource:t.novels,columns:t.columns,pagination:{pageSize:10},loading:t.loading,rowKey:"id"},{bodyCell:n(({column:i,record:m})=>[i.key==="action"?(C(),Y(q,{key:0},{default:n(()=>[o(b,{type:"link",onClick:D=>t.viewNovel(m)},{default:n(()=>e[16]||(e[16]=[r("查看")])),_:2,__:[16]},1032,["onClick"]),o(b,{type:"link",onClick:D=>t.processNovel(m)},{default:n(()=>e[17]||(e[17]=[r("生成有声书")])),_:2,__:[17]},1032,["onClick"]),o(j,null,{overlay:n(()=>[o(P,null,{default:n(()=>[o(v,{key:"1",onClick:D=>t.editConfig(m)},{default:n(()=>e[18]||(e[18]=[r("编辑配置")])),_:2,__:[18]},1032,["onClick"]),o(v,{key:"2",onClick:D=>t.confirmDeleteNovel(m)},{default:n(()=>e[19]||(e[19]=[r("删除")])),_:2,__:[19]},1032,["onClick"])]),_:2},1024)]),default:n(()=>[o(b,{type:"link"},{default:n(()=>[e[20]||(e[20]=r(" 更多 ")),o(A)]),_:1,__:[20]})]),_:2},1024)]),_:2},1024)):R("",!0)]),_:1},8,["dataSource","columns","loading"])]),_:1})]),_:1})]),_:1}),o(z,{visible:t.previewVisible,"onUpdate:visible":e[2]||(e[2]=i=>t.previewVisible=i),title:"小说预览",width:"800px",footer:null},{default:n(()=>[o(W,{spinning:t.previewLoading},{default:n(()=>[t.currentNovel?(C(),B("div",Ne,[o(H,{bordered:"",column:2,size:"small",class:"mb-16"},{default:n(()=>[o(M,{label:"标题",span:"2"},{default:n(()=>[r(F(t.currentNovel.name),1)]),_:1}),o(M,{label:"文件大小"},{default:n(()=>[r(F(t.formatFileSize(t.currentNovel.size)),1)]),_:1}),o(M,{label:"上传时间"},{default:n(()=>[r(F(t.currentNovel.uploadTime),1)]),_:1}),o(M,{label:"章节数"},{default:n(()=>[r(F(t.novelChapters.length),1)]),_:1}),o(M,{label:"状态"},{default:n(()=>[o(G,{color:t.getStatusColor(t.currentNovel.status)},{default:n(()=>[r(F(t.getStatusText(t.currentNovel.status)),1)]),_:1},8,["color"])]),_:1})]),_:1}),o(S,{orientation:"left"},{default:n(()=>e[21]||(e[21]=[r("章节列表")])),_:1,__:[21]}),o(w,null,{default:n(()=>[o(_,{span:8},{default:n(()=>[o(K,{size:"small",bordered:"",class:"chapter-list","data-source":t.novelChapters},{renderItem:n(({item:i})=>{var m;return[o(J,{class:de({"active-chapter":((m=t.selectedChapter)==null?void 0:m.id)===i.id}),onClick:D=>t.selectChapter(i)},{default:n(()=>[h("span",he,F(i.title),1)]),_:2},1032,["class","onClick"])]}),_:1},8,["data-source"])]),_:1}),o(_,{span:16,class:"chapter-content"},{default:n(()=>[t.selectedChapter?(C(),B("div",Fe,[h("div",Me,[h("h3",null,F(t.selectedChapter.title),1)]),o(S),h("div",Ue,[(C(!0),B(pe,null,ce(t.chapterParagraphs,(i,m)=>(C(),B("p",{key:m},F(i),1))),128))])])):(C(),Y(Q,{key:1,description:"选择章节查看内容"}))]),_:1})]),_:1})])):R("",!0)]),_:1},8,["spinning"])]),_:1},8,["visible"]),o(z,{visible:t.configVisible,"onUpdate:visible":e[9]||(e[9]=i=>t.configVisible=i),title:"小说处理配置",onOk:t.saveConfig,confirmLoading:t.savingConfig},{default:n(()=>[o(V,{model:t.configForm,layout:"vertical"},{default:n(()=>[o(c,{label:"默认音色"},{default:n(()=>[o(I,{value:t.configForm.defaultVoice,"onUpdate:value":e[3]||(e[3]=i=>t.configForm.defaultVoice=i)},{default:n(()=>[o(N,{value:"female_young"},{default:n(()=>e[22]||(e[22]=[r("年轻女声")])),_:1,__:[22]}),o(N,{value:"female_mature"},{default:n(()=>e[23]||(e[23]=[r("成熟女声")])),_:1,__:[23]}),o(N,{value:"male_young"},{default:n(()=>e[24]||(e[24]=[r("年轻男声")])),_:1,__:[24]}),o(N,{value:"male_middle"},{default:n(()=>e[25]||(e[25]=[r("中年男声")])),_:1,__:[25]}),o(N,{value:"male_elder"},{default:n(()=>e[26]||(e[26]=[r("老年男声")])),_:1,__:[26]})]),_:1},8,["value"])]),_:1}),o(c,{label:"章节识别模式"},{default:n(()=>[o(a,{value:t.configForm.chapterMode,"onUpdate:value":e[4]||(e[4]=i=>t.configForm.chapterMode=i)},{default:n(()=>[o(U,{value:"auto"},{default:n(()=>e[27]||(e[27]=[r("自动识别")])),_:1,__:[27]}),o(U,{value:"custom"},{default:n(()=>e[28]||(e[28]=[r("自定义模式")])),_:1,__:[28]})]),_:1},8,["value"])]),_:1}),t.configForm.chapterMode==="custom"?(C(),Y(c,{key:0,label:"自定义章节模式"},{default:n(()=>[o(L,{value:t.configForm.chapterPattern,"onUpdate:value":e[5]||(e[5]=i=>t.configForm.chapterPattern=i),placeholder:"输入正则表达式，如: ^第.{1,10}[章节]"},null,8,["value"])]),_:1})):R("",!0),o(c,{label:"处理选项"},{default:n(()=>[o(l,{checked:t.configForm.splitByChapter,"onUpdate:checked":e[6]||(e[6]=i=>t.configForm.splitByChapter=i)},{default:n(()=>e[29]||(e[29]=[r("按章节拆分")])),_:1,__:[29]},8,["checked"]),o(l,{checked:t.configForm.useVoiceMapping,"onUpdate:checked":e[7]||(e[7]=i=>t.configForm.useVoiceMapping=i)},{default:n(()=>e[30]||(e[30]=[r("使用角色声音映射")])),_:1,__:[30]},8,["checked"]),o(l,{checked:t.configForm.detectEmotion,"onUpdate:checked":e[8]||(e[8]=i=>t.configForm.detectEmotion=i)},{default:n(()=>e[31]||(e[31]=[r("情感检测")])),_:1,__:[31]},8,["checked"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","onOk","confirmLoading"])])}const Pe=te(ke,[["render",Le],["__scopeId","data-v-435d3784"]]);export{Pe as default};
