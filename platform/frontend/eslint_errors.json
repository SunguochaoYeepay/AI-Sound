[{"filePath":"D:\\AI-Sound\\platform\\frontend\\src\\components\\ChapterAnalysis.vue","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'_segments' is defined but never used.","line":692,"column":32,"nodeType":"Identifier","messageId":"unusedVar","endLine":692,"endColumn":41}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"<template>\n  <div class=\"chapter-analysis\">\n    <!-- åŠ è½½çŠ¶æ€ -->\n    <div v-if=\"loading\" class=\"loading-wrapper\">\n      <a-spin size=\"large\" tip=\"åŠ è½½æ™ºèƒ½åˆ†æç»“æœ...\">\n        <div style=\"height: 300px\"></div>\n      </a-spin>\n    </div>\n\n    <!-- æœ‰åˆ†ææ•°æ® -->\n    <div v-else-if=\"analysisData\" class=\"analysis-content\">\n      <!-- åˆ†æç»“æœtabs -->\n      <div class=\"analysis-tabs\">\n        <a-tabs v-model=\"activeTab\" type=\"card\">\n          <template #rightExtra>\n            <a-space>\n              <!-- ğŸ”¥ æ–°å¢ï¼šç¼“å­˜çŠ¶æ€æŒ‡ç¤ºå™¨ -->\n              <a-tooltip>\n                <template #title>\n                  <div>\n                    <div>æ•°æ®æ¥æº: {{ getCacheStatusText() }}</div>\n                    <div v-if=\"cacheInfo.user_edited\">ç”¨æˆ·å·²ç¼–è¾‘</div>\n                    <div>æœ€åæ›´æ–°: {{ getLastUpdateTime() }}</div>\n                  </div>\n                </template>\n                <a-tag :color=\"getCacheStatusColor()\" size=\"small\" style=\"cursor: help\">\n                  {{ getCacheStatusIcon() }} {{ getCacheStatusText() }}\n                </a-tag>\n              </a-tooltip>\n\n              <!-- ğŸ”¥ æ–°å¢ï¼šç¼“å­˜æ§åˆ¶æŒ‰é’® -->\n              <a-dropdown>\n                <template #overlay>\n                  <a-menu>\n                    <a-menu-item @click=\"refreshCache\">\n                      <ReloadOutlined />\n                      å¼ºåˆ¶åˆ·æ–°ç¼“å­˜\n                    </a-menu-item>\n                    <a-menu-item @click=\"clearEditCache\">\n                      <ClearOutlined />\n                      æ¸…é™¤ç¼–è¾‘ç¼“å­˜\n                    </a-menu-item>\n                    <a-menu-divider />\n                    <a-menu-item @click=\"clearAllCache\" style=\"color: #ff4d4f\">\n                      <DeleteOutlined />\n                      æ¸…é™¤æ‰€æœ‰ç¼“å­˜\n                    </a-menu-item>\n                  </a-menu>\n                </template>\n                <a-button size=\"small\" type=\"text\">\n                  <SettingOutlined />\n                  ç¼“å­˜\n                  <DownOutlined />\n                </a-button>\n              </a-dropdown>\n\n              <a-button\n                type=\"primary\"\n                @click=\"$emit('refresh')\"\n                size=\"small\"\n                :loading=\"preparingChapter\"\n                :disabled=\"isPreparationDisabled\"\n              >\n                ğŸ¤– æ™ºèƒ½å‡†å¤‡\n              </a-button>\n\n\n              <a-button\n                type=\"primary\"\n                @click=\"saveChanges\"\n                size=\"small\"\n                :loading=\"saving\"\n              >\n                ğŸ’¾ ä¿å­˜ä¿®æ”¹\n              </a-button>\n            </a-space>\n          </template>\n\n          <!-- åˆæˆç‰‡æ®µtab -->\n          <a-tab-pane key=\"segments\" tab=\"ğŸ“ åˆæˆç‰‡æ®µ\">\n            <!-- ğŸ”¥ æ™ºèƒ½æ£€æµ‹ç»„ä»¶ -->\n            <IntelligentDetector\n              v-if=\"bookId && chapterId\"\n              :book-id=\"bookId\"\n              :chapter-id=\"chapterId\"\n              :segments=\"editableSegments\"\n              :characters=\"allAvailableCharacters\"\n              @segments-updated=\"handleSegmentsUpdate\"\n              @locate-segment=\"locateToSegment\"\n              ref=\"intelligentDetectorRef\"\n              style=\"margin-bottom: 16px; padding: 0 16px\"\n            />\n\n            <!-- ğŸ”¥ ä½¿ç”¨æ–°çš„åˆæˆç‰‡æ®µç¼–è¾‘å™¨ -->\n            <SynthesisSegmentEditor\n              :segments=\"editableSegments\"\n              :characters=\"allAvailableCharacters\"\n              :loading=\"loading\"\n              @update:segments=\"handleSegmentsUpdate\"\n              @segment-change=\"handleSegmentChange\"\n              @character-change=\"handleCharacterChange\"\n              @refresh-characters=\"loadBookCharacters\"\n            />\n          </a-tab-pane>\n\n          <!-- JSONæ•°æ®tab -->\n          <a-tab-pane key=\"json\" tab=\"ğŸ”§ JSONæ•°æ®\">\n            <JsonDataViewer\n              :analysis-data=\"analysisData\"\n              :editable-segments=\"editableSegments\"\n              :editable-characters=\"editableCharacters\"\n              @json-changed=\"handleJsonChanged\"\n              @save-json=\"handleSaveJson\"\n            />\n          </a-tab-pane>\n\n          <!-- è§’è‰²ä¿¡æ¯tab -->\n          <a-tab-pane key=\"characters\" tab=\"ğŸ­ è§’è‰²ä¿¡æ¯\">\n            <CharacterInfoViewer\n              :characters=\"editableCharacters\"\n              :segments=\"editableSegments\"\n              :highlighted-character=\"highlightedCharacter\"\n              :testing-voice=\"testingVoice\"\n              :missing-characters-count=\"missingCharactersCount\"\n              :batch-creating=\"batchCreating\"\n              :loading-book-characters=\"loadingBookCharacters\"\n              @highlight-character=\"handleHighlightCharacter\"\n              @export-segments=\"handleExportSegments\"\n              @test-voice=\"handleTestVoice\"\n              @batch-create-characters=\"showBatchCreateModal\"\n              @refresh-character-library=\"refreshCharacterLibrary\"\n            />\n          </a-tab-pane>\n        </a-tabs>\n      </div>\n    </div>\n\n    <!-- æ— åˆ†ææ•°æ® -->\n    <div v-else class=\"no-analysis\">\n      <a-empty description=\"è¯¥ç« èŠ‚æš‚æ— æ™ºèƒ½åˆ†ææ•°æ®\" :image=\"false\">\n        <div class=\"empty-icon\">ğŸ¤–</div>\n        <p>è¯·å…ˆå¯¹ç« èŠ‚è¿›è¡Œæ™ºèƒ½å‡†å¤‡</p>\n        <a-button type=\"primary\" @click=\"$emit('refresh')\"> ğŸ­ å¼€å§‹æ™ºèƒ½å‡†å¤‡ </a-button>\n      </a-empty>\n    </div>\n\n    <!-- ğŸ”¥ æ‰¹é‡åˆ›å»ºè§’è‰²æŠ½å±‰ç»„ä»¶ -->\n    <BatchCreateCharacterDrawer\n      ref=\"batchCreateDrawerRef\"\n      :chapter=\"chapter\"\n      :missing-characters=\"missingCharacters\"\n      v-model:visible=\"batchCreateModalVisible\"\n      v-model:batch-creating=\"batchCreating\"\n      @characters-created=\"handleCharactersCreated\"\n      @refresh-library=\"refreshCharacterLibrary\"\n    />\n\n    <!-- æ£€æµ‹è¯¦æƒ…æ¨¡æ€æ¡†å·²ç§»è‡³IntelligentDetectorç»„ä»¶ -->\n\n\n  </div>\n</template>\n\n<script setup>\n  import { ref, computed, watch, onMounted, nextTick } from 'vue'\n  import { message, Modal } from 'ant-design-vue'\n  // import { useAudioPlayerStore } from '@/stores/audioPlayer' // ç§»é™¤æœªä½¿ç”¨çš„å¯¼å…¥\n  import { charactersAPI } from '@/api'\n  // import draggable from 'vuedraggable' // ç§»é™¤æœªä½¿ç”¨çš„å¯¼å…¥\n  import SynthesisSegmentEditor from './SynthesisSegmentEditor.vue'\n  import IntelligentDetector from './IntelligentDetector.vue'\n  import BatchCreateCharacterDrawer from './BatchCreateCharacterDrawer.vue'\n\n  import {\n    ReloadOutlined,\n    ClearOutlined,\n    DeleteOutlined,\n    SettingOutlined,\n    DownOutlined\n  } from '@ant-design/icons-vue'\n  // Removed unused imports: smartPrepareAPI, deepAnalyzeAPI\n\n  // åœ¨Vue 3 setup scriptä¸­ï¼Œå¯¼å…¥çš„ç»„ä»¶å¯ä»¥ç›´æ¥åœ¨æ¨¡æ¿ä¸­ä½¿ç”¨\n\n  const props = defineProps({\n    chapter: {\n      type: Object,\n      default: null\n    },\n    analysisData: {\n      type: Object,\n      default: null\n    },\n    loading: {\n      type: Boolean,\n      default: false\n    },\n    preparingChapter: {\n      type: Boolean,\n      default: false\n    },\n    preparationStatus: {\n      type: Object,\n      default: null\n    }\n  })\n\n  const emit = defineEmits(['refresh', 'save'])\n\n  // const audioStore = useAudioPlayerStore() // ç§»é™¤æœªä½¿ç”¨çš„å˜é‡\n\n  // ç»„ä»¶æ³¨å†Œ - Vue 3ç‰ˆæœ¬çš„vuedraggableç›´æ¥ä½¿ç”¨å¯¼å…¥çš„ç»„ä»¶\n\n  const activeTab = ref('segments')\n  const saving = ref(false)\n  const hasChanges = ref(false)\n  const highlightedCharacter = ref(null)\n  const testingVoice = ref(null)\n  // æ™ºèƒ½æ£€æµ‹ç›¸å…³çŠ¶æ€\n  // æ™ºèƒ½æ£€æµ‹ç›¸å…³çŠ¶æ€ï¼ˆå·²ç§»è‡³IntelligentDetectorç»„ä»¶ï¼‰\n  // const detecting = ref(false) - å·²ç§»é™¤\n  // const detectionResult = ref(null) - å·²ç§»é™¤\n  // const showDetectionDetails = ref(false) // ç§»é™¤æœªä½¿ç”¨çš„å˜é‡\n  // const applyingFix = ref(false) - å·²ç§»é™¤\n\n  // ğŸ”¥ æ–°å¢ï¼šç¼“å­˜çŠ¶æ€ä¿¡æ¯\n  const cacheInfo = ref({\n    data_source: 'synthesis_plan',\n    user_edited: false,\n    cache_status: 'cached',\n    last_updated: null\n  })\n\n  // å¯ç¼–è¾‘çš„æ•°æ®\n  const editableCharacters = ref([])\n  const editableSegments = ref([])\n  const originalData = ref(null)\n\n  // ğŸ”¥ æ–°å¢ï¼šåŠ è½½æœ¬ä¹¦æ‰€æœ‰è§’è‰²\n  const loadingBookCharacters = ref(false)\n  const bookCharacters = ref([])\n\n  // æ‰¹é‡åˆ›å»ºè§’è‰²ç›¸å…³çŠ¶æ€å·²ç§»è‡³ç‹¬ç«‹ç»„ä»¶\n  const batchCreating = ref(false)\n  \n  // ç»„ä»¶å¼•ç”¨\n  const intelligentDetectorRef = ref(null)\n\n\n\n  // Removed unused variables: rawText, segments\n\n\n\n  const loadBookCharacters = async () => {\n    if (!props.chapter?.book_id) {\n      console.warn('ç¼ºå°‘ä¹¦ç±IDï¼Œæ— æ³•åŠ è½½è§’è‰²')\n      return\n    }\n\n    loadingBookCharacters.value = true\n    try {\n      const response = await charactersAPI.getCharacters({ book_id: props.chapter.book_id })\n      if (response.data?.success && response.data.data) {\n        bookCharacters.value = response.data.data.map((char) => ({\n          ...char,\n          is_voice_configured: char.is_voice_configured || false,\n          avatarUrl: char.avatarUrl || null\n        }))\n        console.log('æœ¬ä¹¦è§’è‰²åŠ è½½æˆåŠŸ:', bookCharacters.value.length, 'ä¸ªè§’è‰²')\n      } else {\n        console.warn('åŠ è½½è§’è‰²å¤±è´¥:', response.data?.message)\n      }\n    } catch (error) {\n      console.error('åŠ è½½è§’è‰²å¤±è´¥:', error)\n    } finally {\n      loadingBookCharacters.value = false\n    }\n  }\n\n  // ğŸ”¥ æ–°å¢ï¼šè·å–ä¸åœ¨è§’è‰²é…éŸ³åº“ä¸­çš„è§’è‰²\n  const missingCharacters = computed(() => {\n    return editableCharacters.value.filter((char) => !char.in_character_library)\n  })\n\n  // ğŸ”¥ æ–°å¢ï¼šå¾…æ·»åŠ è§’è‰²æ•°é‡\n  const missingCharactersCount = computed(() => {\n    return missingCharacters.value.length\n  })\n\n  // ç§»é™¤æœªä½¿ç”¨çš„è®¡ç®—å±æ€§ï¼šhasAnalysisData\n\n  // è¯­éŸ³ç±»å‹é€‰é¡¹ã€è§’è‰²è¡¨æ ¼åˆ—é…ç½®ã€è¡¨æ ¼è¡Œé€‰æ‹©é…ç½®å·²ç§»è‡³BatchCreateCharacterDrawerç»„ä»¶\n\n  // ğŸ”¥ æ–°å¢ï¼šå¼ºåˆ¶åˆ·æ–°æ–¹æ³•\n  const forceRefreshSegments = async () => {\n    console.log('[è§’è‰²åˆ†æ] å¼ºåˆ¶åˆ·æ–°segmentsæ•°æ®')\n    await nextTick()\n    // è§¦å‘å“åº”å¼æ›´æ–°\n    const temp = [...editableSegments.value]\n    editableSegments.value = []\n    await nextTick()\n    editableSegments.value = temp\n    console.log('[è§’è‰²åˆ†æ] å¼ºåˆ¶åˆ·æ–°å®Œæˆï¼Œå½“å‰segmentsæ•°é‡:', editableSegments.value.length)\n  }\n\n  // Removed unused computed property: processingInfo\n\n  // æ˜¯å¦ç¦ç”¨å‡†å¤‡æŒ‰é’®\n  const isPreparationDisabled = computed(() => {\n    return (\n      props.preparingChapter ||\n      props.preparationStatus?.analysis_status === 'processing' ||\n      props.preparationStatus?.synthesis_status === 'processing'\n    )\n  })\n\n  // ğŸ”¥ ç®€åŒ–ï¼šåˆå§‹åŒ–å¯ç¼–è¾‘æ•°æ®ï¼Œç›´æ¥ä½¿ç”¨JSONä¸­çš„è§’è‰²ä¿¡æ¯\n  const initEditableData = async () => {\n    if (!props.analysisData?.synthesis_json) {\n      console.warn('[è§’è‰²åˆ†æ] æ²¡æœ‰æœ‰æ•ˆçš„åˆ†æç»“æœæ•°æ®')\n      return\n    }\n\n    const synthesisJson = props.analysisData.synthesis_json\n\n    try {\n      // ğŸ”¥ ä¼˜åŒ–ï¼šæ™ºèƒ½æå–è§’è‰²ä¿¡æ¯ï¼Œä¼˜å…ˆä½¿ç”¨characterså­—æ®µï¼Œfallbackåˆ°synthesis_plan\n      console.log('[è§’è‰²åˆ†æ] å¼€å§‹æå–è§’è‰²ä¿¡æ¯')\n\n      if (synthesisJson.characters && synthesisJson.characters.length > 0) {\n        // å¦‚æœæœ‰characterså­—æ®µï¼Œç›´æ¥ä½¿ç”¨\n        console.log('[è§’è‰²åˆ†æ] ä½¿ç”¨characterså­—æ®µ')\n        editableCharacters.value = synthesisJson.characters.map((char) => ({\n          ...char,\n          character_id: char.character_id || null,\n          voice_id: char.voice_id || '',\n          voice_name: char.voice_name || char.name || 'æœªåˆ†é…',\n          voice_type: char.voice_type || (char.name === 'æ—ç™½' ? 'narrator' : 'neutral'),\n          count: char.count || 0,\n          in_character_library: char.in_character_library || false,\n          is_voice_configured: char.is_voice_configured || false,\n          avatarUrl: char.avatarUrl || null\n        }))\n      } else {\n        // å¦‚æœæ²¡æœ‰characterså­—æ®µï¼Œä»synthesis_planä¸­æå–\n        console.log('[è§’è‰²åˆ†æ] ä»synthesis_planä¸­æå–è§’è‰²ä¿¡æ¯')\n        const segments = synthesisJson.synthesis_plan || []\n        const characterMap = new Map()\n\n        // ç»Ÿè®¡æ¯ä¸ªè§’è‰²çš„å‡ºç°æ¬¡æ•°å’Œä¿¡æ¯\n        segments.forEach((segment) => {\n          // ğŸ”¥ ä¿®å¤ï¼šä½¿ç”¨æ­£ç¡®çš„è¯´è¯äººå­—æ®µæ˜ å°„ï¼Œæ”¯æŒå¤šç§å¯èƒ½çš„å­—æ®µå\n          const speaker = segment.speaker || segment.speaker_name || segment.character_name || segment.character || 'æœªçŸ¥'\n          if (!characterMap.has(speaker)) {\n            characterMap.set(speaker, {\n              name: speaker,\n              character_id: segment.character_id || null,\n              voice_id: segment.voice_id || '',\n              voice_name: segment.voice_name || speaker,\n              voice_type: speaker === 'æ—ç™½' ? 'narrator' : 'neutral',\n              count: 0,\n              in_character_library: segment.character_id ? true : false,\n              is_voice_configured: segment.voice_id ? true : false,\n              avatarUrl: null\n            })\n          }\n          characterMap.get(speaker).count++\n        })\n\n        // è½¬æ¢ä¸ºæ•°ç»„\n        editableCharacters.value = Array.from(characterMap.values())\n      }\n\n      // å¯¹è§’è‰²æŒ‰å‡ºç°æ¬¡æ•°æ’åº\n      editableCharacters.value.sort((a, b) => (b.count || 0) - (a.count || 0))\n\n      console.log('[è§’è‰²åˆ†æ] æœ€ç»ˆè§’è‰²ä¿¡æ¯:', editableCharacters.value)\n\n      // åˆå§‹åŒ–å¯ç¼–è¾‘çš„åˆæˆè®¡åˆ’ï¼Œç¡®ä¿åŒ…å«æ‰€æœ‰å¿…è¦å­—æ®µ\n      const segments = synthesisJson.synthesis_plan || []\n      editableSegments.value = segments.map((segment, index) => {\n        // ğŸ”¥ è°ƒè¯•æ—¥å¿—ï¼šæ‰“å°åŸå§‹segmentæ•°æ®\n        console.log(`[å­—æ®µæ˜ å°„è°ƒè¯•] åŸå§‹segment ${index}:`, {\n          segment_id: segment.segment_id,\n          speaker: segment.speaker,\n          text: segment.text ? segment.text.substring(0, 50) + '...' : 'NO_TEXT',\n          voice_id: segment.voice_id,\n          character_id: segment.character_id\n        })\n\n        // ğŸ”¥ ä¿®å¤ï¼šç¡®ä¿æ‰€æœ‰å¿…è¦å­—æ®µéƒ½æ­£ç¡®æ˜ å°„\n        const mappedSegment = {\n          ...segment,\n          // ç¡®ä¿IDå­—æ®µæ­£ç¡®\n          id: segment.id || segment.segment_id || `segment_${index}_${Date.now()}`,\n          segment_id: segment.segment_id || (index + 1),\n          chapter_id: segment.chapter_id || props.chapter?.id || null,\n          chapter_number: segment.chapter_number || props.chapter?.number || 1,\n          // ğŸ”¥ å…³é”®ä¿®å¤ï¼šç¡®ä¿speakerå’Œtextå­—æ®µæ­£ç¡®æ˜¾ç¤º\n          speaker: segment.speaker || 'æœªçŸ¥è¯´è¯äºº',\n          text: segment.text || '',\n          \n          // ğŸ”¥ å¼ºåˆ¶å“åº”å¼æ›´æ–°\n          _forceUpdate: Date.now(),\n          \n          // è¯­éŸ³é…ç½®å­—æ®µ\n          character_id: segment.character_id || null,\n          voice_id: segment.voice_id || '',\n          voice_name: segment.voice_name || 'æœªåˆ†é…',\n          \n          // å…¶ä»–å¿…è¦å­—æ®µ\n          text_type: segment.text_type || 'narration',\n          confidence: segment.confidence || 0.9,\n          detection_rule: segment.detection_rule || 'manual_input',\n          timeStep: segment.timeStep || 32,\n          pWeight: segment.pWeight || 2,\n          tWeight: segment.tWeight || 3,\n          narrator_mode: segment.narrator_mode !== undefined ? segment.narrator_mode : true,\n          skip_ai_analysis: segment.skip_ai_analysis !== undefined ? segment.skip_ai_analysis : false\n        }\n\n        // ğŸ”¥ éªŒè¯å…³é”®å­—æ®µ\n        if (!mappedSegment.text) {\n          console.warn(`âš ï¸ æ®µè½ ${index} ç¼ºå°‘æ–‡æœ¬å†…å®¹:`, segment)\n        }\n        if (!mappedSegment.speaker || mappedSegment.speaker === 'æœªçŸ¥è¯´è¯äºº') {\n          console.warn(`âš ï¸ æ®µè½ ${index} ç¼ºå°‘è¯´è¯äººä¿¡æ¯:`, segment)\n        }\n\n        console.log(`[å­—æ®µæ˜ å°„è°ƒè¯•] æ˜ å°„åsegment ${index}:`, {\n          segment_id: mappedSegment.segment_id,\n          speaker: mappedSegment.speaker,\n          text: mappedSegment.text.substring(0, 50) + '...',\n          character_id: mappedSegment.character_id,\n          voice_id: mappedSegment.voice_id\n        })\n\n        return mappedSegment\n      })\n\n      // ä¿å­˜åŸå§‹æ•°æ®ç”¨äºæ¯”è¾ƒå˜åŒ–\n      originalData.value = JSON.parse(\n        JSON.stringify({\n          characters: editableCharacters.value,\n          segments: editableSegments.value\n        })\n      )\n\n      console.log('[è§’è‰²åˆ†æ] æ•°æ®åˆå§‹åŒ–å®Œæˆ')\n      \n      // ğŸ”¥ ä¿®å¤ï¼šé‡ç½®hasChangesçŠ¶æ€ï¼Œé¿å…ä¿å­˜æŒ‰é’®è¢«ç¦ç”¨\n      hasChanges.value = false\n      \n      // ğŸ”¥ å¼ºåˆ¶Vueé‡æ–°æ¸²æŸ“\n      await nextTick()\n      console.log('[è§’è‰²åˆ†æ] å¼ºåˆ¶é‡æ–°æ¸²æŸ“å®Œæˆ')\n      \n      // ğŸ”¥ å¼ºåˆ¶åˆ·æ–°æ–¹æ³•ç¡®ä¿æ•°æ®æ­£ç¡®æ˜¾ç¤º\n      await forceRefreshSegments()\n    } catch (error) {\n      console.error('[è§’è‰²åˆ†æ] åˆå§‹åŒ–æ•°æ®å¤±è´¥:', error)\n      message.error('åˆå§‹åŒ–è§’è‰²åˆ†ææ•°æ®å¤±è´¥')\n    }\n  }\n\n  // ğŸ”¥ ä¿®å¤ï¼šç›‘å¬åˆ†ææ•°æ®å˜åŒ–ï¼Œç¡®ä¿æ•°æ®æ­£ç¡®åˆå§‹åŒ–\n  watch(\n    () => props.analysisData,\n    async (newData) => {\n      console.log('[è§’è‰²åˆ†æ] ç›‘å¬åˆ°analysisDataå˜åŒ–:', newData)\n      if (newData) {\n        console.log('[è§’è‰²åˆ†æ] å¼€å§‹åˆå§‹åŒ–å¯ç¼–è¾‘æ•°æ®...')\n        await initEditableData()\n        console.log('[è§’è‰²åˆ†æ] åˆå§‹åŒ–å®Œæˆï¼Œå½“å‰è§’è‰²æ•°:', editableCharacters.value.length)\n      } else {\n        console.log('[è§’è‰²åˆ†æ] analysisDataä¸ºç©ºï¼Œæ¸…ç©ºç¼–è¾‘æ•°æ®')\n        editableCharacters.value = []\n        editableSegments.value = []\n      }\n    },\n    { immediate: true, deep: true }\n  )\n\n  // ğŸ”¥ æ–°å¢ï¼šå½“æ²¡æœ‰åˆ†ææ•°æ®ä½†æœ‰è§’è‰²åº“æ•°æ®æ—¶ï¼Œåˆ›å»ºåŸºç¡€è§’è‰²\n  watch(\n    () => [props.analysisData, bookCharacters.value],\n    ([analysisData, bookChars]) => {\n      // å¦‚æœæ²¡æœ‰åˆ†ææ•°æ®ä½†æœ‰è§’è‰²åº“æ•°æ®ï¼Œä¸”å½“å‰editableCharactersä¸ºç©º\n      if (!analysisData && bookChars.length > 0 && editableCharacters.value.length === 0) {\n        console.log('[è§’è‰²åˆ†æ] åŸºäºè§’è‰²åº“åˆ›å»ºåŸºç¡€è§’è‰²é€‰é¡¹')\n        editableCharacters.value = bookChars.map(char => ({\n          name: char.name,\n          character_id: char.id,\n          voice_id: char.id.toString(),\n          voice_name: char.name,\n          voice_type: char.voice_type || 'neutral',\n          count: 0,\n          in_character_library: true,\n          is_voice_configured: char.is_voice_configured || false,\n          avatarUrl: char.avatarUrl || null\n        }))\n        console.log('[è§’è‰²åˆ†æ] åŸºç¡€è§’è‰²åˆ›å»ºå®Œæˆ:', editableCharacters.value.length, 'ä¸ªè§’è‰²')\n      }\n    },\n    { deep: true }\n  )\n\n  // ğŸ”¥ æ–°å¢ï¼šç›‘å¬ç« èŠ‚å˜åŒ–ï¼Œè‡ªåŠ¨åŠ è½½æœ¬ä¹¦è§’è‰²\n  watch(\n    () => props.chapter,\n    (newChapter) => {\n      if (newChapter?.book_id) {\n        loadBookCharacters()\n      }\n    },\n    { immediate: true }\n  )\n\n  // ğŸ”¥ æ–°å¢ï¼šé¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–\n  onMounted(() => {\n    if (props.chapter?.book_id) {\n      loadBookCharacters()\n    }\n  })\n\n  // æ‰¹é‡åˆ›å»ºè§’è‰²ç›¸å…³æ–¹æ³•å·²ç§»è‡³BatchCreateCharacterDrawerç»„ä»¶\n  \n  const refreshCharacterLibrary = async () => {\n    await loadBookCharacters()\n    // é‡æ–°æ£€æŸ¥è§’è‰²é…éŸ³åº“å…³è”çŠ¶æ€\n    await initEditableData()\n    message.success('è§’è‰²é…éŸ³åº“å·²åˆ·æ–°')\n  }\n\n  // ç§»é™¤æœªä½¿ç”¨çš„å‡½æ•°ï¼šupdateSynthesisPlanWithNewCharacterNames\n\n  // æ ‡è®°ä¸ºå·²ä¿®æ”¹\n  const markChanged = () => {\n    hasChanges.value = true\n  }\n\n\n\n  // ğŸ”¥ ä¿®å¤ç¼ºå¤±å­—æ®µçš„æ®µè½ - ä¿æŒåŸæœ‰segment_idä¸å˜\n  const fixMissingFields = (_segments) => {\n    // è·å–æ‰€æœ‰å·²æœ‰çš„segment_id\n    const existingSegmentIds = _segments.map((s) => s.segment_id).filter((id) => id)\n    const maxSegmentId = Math.max(...existingSegmentIds, 0)\n\n    let newSegmentCounter = 1\n\n    return _segments.map((segment, index) => {\n      // ğŸ”¥ å…³é”®ä¿®å¤ï¼šåªä¿®å¤ç¼ºå¤±å­—æ®µï¼Œä¿æŒåŸæœ‰segment_idä¸å˜\n      if (!segment.segment_id || !segment.chapter_id || !segment.text_type) {\n        console.log(`[ä¿®å¤æ®µè½] ä¿®å¤æ®µè½ ${index + 1} çš„ç¼ºå¤±å­—æ®µ`)\n\n        // åªæœ‰åœ¨segment_idçœŸæ­£ç¼ºå¤±æ—¶æ‰åˆ†é…æ–°çš„ID\n        let newSegmentId = segment.segment_id\n        if (!newSegmentId) {\n          // ä¸ºæ–°æ®µè½åˆ†é…æ–°çš„segment_idï¼Œç¡®ä¿ä¸é‡å¤\n          newSegmentId = maxSegmentId + newSegmentCounter\n          newSegmentCounter++\n        }\n\n        return {\n          ...segment,\n          segment_id: newSegmentId,\n          chapter_id: segment.chapter_id || props.chapter?.id || null,\n          chapter_number: segment.chapter_number || props.chapter?.number || 1,\n          text_type: segment.text_type || 'narration',\n          confidence: segment.confidence || 0.9,\n          detection_rule: segment.detection_rule || 'manual_input',\n          timeStep: segment.timeStep || 32,\n          pWeight: segment.pWeight || 2,\n          tWeight: segment.tWeight || 3,\n          narrator_mode: segment.narrator_mode !== undefined ? segment.narrator_mode : true,\n          skip_ai_analysis:\n            segment.skip_ai_analysis !== undefined ? segment.skip_ai_analysis : false,\n          character_id: segment.character_id || null,\n          voice_id: segment.voice_id || ''\n        }\n      }\n      // ğŸ”¥ å…³é”®ï¼šå¯¹äºå·²æœ‰å®Œæ•´å­—æ®µçš„æ®µè½ï¼Œä¿æŒåŸæ ·ä¸å˜\n      return segment\n    })\n  }\n\n  // ä¿å­˜ä¿®æ”¹\n  const saveChanges = async () => {\n    // ğŸ”¥ ä¿®å¤ï¼šå³ä½¿hasChangesä¸ºfalseä¹Ÿå…è®¸ä¿å­˜ï¼Œç¡®ä¿æŒ‰é’®æœ‰å“åº”\n    if (!hasChanges.value) {\n      console.log('ğŸ“ æ²¡æœ‰æ£€æµ‹åˆ°æ•°æ®å˜åŒ–ï¼Œä½†ä»å…è®¸ä¿å­˜')\n    }\n\n    saving.value = true\n    try {\n      console.log('ğŸš€ å¼€å§‹ä¿å­˜æ™ºèƒ½åˆ†ææ•°æ®...')\n      \n      // ğŸ”¥ ä¿®å¤ç¼ºå¤±å­—æ®µçš„æ®µè½\n      const fixedSegments = fixMissingFields(editableSegments.value)\n\n      // ğŸ”¥ ä¿®å¤ï¼šåŒæ­¥æ›´æ–°total_segmentså­—æ®µ\n      const currentTotalSegments = fixedSegments.length\n      console.log('ğŸ’¾ ä¿å­˜æ—¶æ›´æ–°total_segments:', {\n        åŸå§‹total_segments: props.analysisData.synthesis_json.project_info?.total_segments,\n        å®é™…æ®µè½æ•°é‡: currentTotalSegments\n      })\n\n      const updatedData = {\n        ...props.analysisData,\n        synthesis_json: {\n          ...props.analysisData.synthesis_json,\n          project_info: {\n            ...props.analysisData.synthesis_json.project_info,\n            total_segments: currentTotalSegments\n          },\n          processing_info: {\n            ...props.analysisData.synthesis_json.processing_info,\n            total_segments: currentTotalSegments\n          },\n          characters: editableCharacters.value,\n          synthesis_plan: fixedSegments\n        }\n      }\n\n      console.log('ğŸ“¤ å‘é€ä¿å­˜äº‹ä»¶åˆ°çˆ¶ç»„ä»¶:', {\n        chapterId: props.chapter?.id,\n        dataLength: JSON.stringify(updatedData).length,\n        segmentsCount: fixedSegments.length,\n        charactersCount: editableCharacters.value.length,\n        hasChanges: hasChanges.value\n      })\n\n      // ğŸ”¥ ä¿®å¤ï¼šå¼ºåˆ¶è§¦å‘ä¿å­˜äº‹ä»¶\n      emit('save', updatedData)\n      \n      // ğŸ”¥ ä¿®å¤ï¼šé‡ç½®å˜æ›´çŠ¶æ€\n      hasChanges.value = false\n      message.success('ä¿å­˜æˆåŠŸï¼æ•°æ®å·²æ›´æ–°åˆ°æœåŠ¡å™¨')\n    } catch (error) {\n      console.error('âŒ ä¿å­˜å¤±è´¥:', error)\n      message.error('ä¿å­˜å¤±è´¥: ' + (error.message || 'æœªçŸ¥é”™è¯¯'))\n    } finally {\n      saving.value = false\n    }\n  }\n\n\n\n\n\n  // ç§»é™¤æœªä½¿ç”¨çš„å‡½æ•°ï¼šgetJsonPreview\n\n  // ç§»é™¤æœªä½¿ç”¨çš„å‡½æ•°ï¼šcopyJson, handleBatchCreateCharacters, getCharacterColor\n\n\n\n\n\n\n\n\n\n\n  // ğŸ”¥ æ–°å¢ï¼šåˆæˆç‰‡æ®µç¼–è¾‘å™¨ç›¸å…³æ–¹æ³•\n  // åˆå¹¶æ‰€æœ‰å¯ç”¨è§’è‰²\n  const allAvailableCharacters = computed(() => {\n    const combined = [...editableCharacters.value, ...bookCharacters.value]\n    // å»é‡ï¼Œä¼˜å…ˆä¿ç•™editableCharactersä¸­çš„è§’è‰²\n    const uniqueCharacters = []\n    const seen = new Set()\n    \n    for (const char of combined) {\n      if (!seen.has(char.name)) {\n        seen.add(char.name)\n        uniqueCharacters.push(char)\n      }\n    }\n    \n    return uniqueCharacters\n  })\n\n  // å¤„ç†ç‰‡æ®µæ›´æ–°\n  const handleSegmentsUpdate = (_segments) => {\n    console.log('[ChapterAnalysis] ç‰‡æ®µæ›´æ–°:', _segments.length, 'ä¸ªç‰‡æ®µ')\n    editableSegments.value = _segments\n    markChanged()\n  }\n\n  // å¤„ç†ç‰‡æ®µå˜åŒ–\n  const handleSegmentChange = (_segments) => {\n    console.log('[ChapterAnalysis] ç‰‡æ®µå†…å®¹å˜åŒ–')\n    markChanged()\n  }\n\n  // å¤„ç†è§’è‰²å˜åŒ–\n  const handleCharacterChange = (segment, speaker) => {\n    console.log('[ChapterAnalysis] è§’è‰²å˜åŒ–:', segment.id, speaker)\n    markChanged()\n  }\n\n  // å®šä½åˆ°æŒ‡å®šç‰‡æ®µ\n  const locateToSegment = (segmentIndex) => {\n    console.log('[ChapterAnalysis] å®šä½ç‰‡æ®µ:', segmentIndex)\n    // å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ æ»šåŠ¨åˆ°æŒ‡å®šç‰‡æ®µçš„é€»è¾‘\n    // ä¾‹å¦‚ï¼šæ»šåŠ¨åˆ°å¯¹åº”çš„DOMå…ƒç´ \n    const segmentElement = document.querySelector(`[data-segment-index=\"${segmentIndex}\"]`)\n    if (segmentElement) {\n      segmentElement.scrollIntoView({ behavior: 'smooth', block: 'center' })\n      // æ·»åŠ é«˜äº®æ•ˆæœ\n      segmentElement.classList.add('segment-highlighted')\n      setTimeout(() => {\n        segmentElement.classList.remove('segment-highlighted')\n      }, 3000)\n    }\n  }\n\n  // ğŸ”¥ æ–°å¢ï¼šç¼“å­˜æ§åˆ¶æ–¹æ³•\n  // è·å–ç¼“å­˜çŠ¶æ€æ–‡æœ¬\n  const getCacheStatusText = () => {\n    switch (cacheInfo.value.data_source) {\n      case 'final_config':\n        return 'ç”¨æˆ·ç¼–è¾‘'\n      case 'synthesis_plan':\n        return 'æ™ºèƒ½å‡†å¤‡'\n      default:\n        return 'æœªçŸ¥'\n    }\n  }\n\n  // è·å–ç¼“å­˜çŠ¶æ€é¢œè‰²\n  const getCacheStatusColor = () => {\n    if (cacheInfo.value.user_edited) return 'purple'\n    if (cacheInfo.value.cache_status === 'fresh') return 'green'\n    return 'blue'\n  }\n\n  // è·å–ç¼“å­˜çŠ¶æ€å›¾æ ‡\n  const getCacheStatusIcon = () => {\n    if (cacheInfo.value.user_edited) return 'âœï¸'\n    if (cacheInfo.value.cache_status === 'fresh') return 'ğŸ”„'\n    return 'ğŸ’¾'\n  }\n\n  // è·å–æœ€åæ›´æ–°æ—¶é—´\n  const getLastUpdateTime = () => {\n    if (!cacheInfo.value.last_updated) return 'æœªçŸ¥'\n    try {\n      const date = new Date(cacheInfo.value.last_updated)\n      return date.toLocaleString('zh-CN')\n    } catch {\n      return 'æœªçŸ¥'\n    }\n  }\n\n  // å¼ºåˆ¶åˆ·æ–°ç¼“å­˜\n  const refreshCache = async () => {\n    try {\n      message.loading('æ­£åœ¨åˆ·æ–°ç¼“å­˜...', 0)\n      // å‘é€å¸¦æœ‰force_refreshå‚æ•°çš„è¯·æ±‚\n      emit('refresh', { force_refresh: true })\n      message.destroy()\n      message.success('ç¼“å­˜å·²åˆ·æ–°ï¼Œå°†æ˜¾ç¤ºæœ€æ–°æ•°æ®')\n    } catch (error) {\n      message.destroy()\n      message.error('åˆ·æ–°ç¼“å­˜å¤±è´¥')\n      console.error('åˆ·æ–°ç¼“å­˜å¤±è´¥:', error)\n    }\n  }\n\n  // æ¸…é™¤ç¼–è¾‘ç¼“å­˜\n  const clearEditCache = async () => {\n    try {\n      if (!props.chapter?.id) {\n        message.error('ç¼ºå°‘ç« èŠ‚ä¿¡æ¯')\n        return\n      }\n\n      message.loading('æ­£åœ¨æ¸…é™¤ç¼–è¾‘ç¼“å­˜...', 0)\n\n      // è°ƒç”¨APIæ¸…é™¤final_configç¼“å­˜\n      await charactersAPI.clearPreparationCache(props.chapter.id, 'final_config')\n\n      message.destroy()\n      message.success('ç¼–è¾‘ç¼“å­˜å·²æ¸…é™¤ï¼Œå°†æ˜¾ç¤ºæ™ºèƒ½å‡†å¤‡ç»“æœ')\n\n      // åˆ·æ–°æ•°æ®\n      emit('refresh', { force_refresh: true })\n    } catch (error) {\n      message.destroy()\n      message.error('æ¸…é™¤ç¼–è¾‘ç¼“å­˜å¤±è´¥')\n      console.error('æ¸…é™¤ç¼–è¾‘ç¼“å­˜å¤±è´¥:', error)\n    }\n  }\n\n  // æ¸…é™¤æ‰€æœ‰ç¼“å­˜\n  const clearAllCache = async () => {\n    try {\n      if (!props.chapter?.id) {\n        message.error('ç¼ºå°‘ç« èŠ‚ä¿¡æ¯')\n        return\n      }\n\n      // ç¡®è®¤æ“ä½œ\n      const confirmed = await new Promise((resolve) => {\n        Modal.confirm({\n          title: 'ç¡®è®¤æ¸…é™¤æ‰€æœ‰ç¼“å­˜',\n          content: 'è¿™å°†åˆ é™¤æ‰€æœ‰æ™ºèƒ½å‡†å¤‡ç»“æœï¼Œéœ€è¦é‡æ–°è¿›è¡Œæ™ºèƒ½å‡†å¤‡ã€‚ç¡®å®šç»§ç»­å—ï¼Ÿ',\n          okText: 'ç¡®è®¤æ¸…é™¤',\n          cancelText: 'å–æ¶ˆ',\n          okButtonProps: { danger: true },\n          onOk: () => resolve(true),\n          onCancel: () => resolve(false)\n        })\n      })\n\n      if (!confirmed) return\n\n      message.loading('æ­£åœ¨æ¸…é™¤æ‰€æœ‰ç¼“å­˜...', 0)\n\n      // è°ƒç”¨APIæ¸…é™¤æ‰€æœ‰ç¼“å­˜\n      await charactersAPI.clearPreparationCache(props.chapter.id, 'all')\n\n      message.destroy()\n      message.success('æ‰€æœ‰ç¼“å­˜å·²æ¸…é™¤ï¼Œè¯·é‡æ–°è¿›è¡Œæ™ºèƒ½å‡†å¤‡')\n\n      // åˆ·æ–°æ•°æ®\n      emit('refresh')\n    } catch (error) {\n      message.destroy()\n      message.error('æ¸…é™¤æ‰€æœ‰ç¼“å­˜å¤±è´¥')\n      console.error('æ¸…é™¤æ‰€æœ‰ç¼“å­˜å¤±è´¥:', error)\n    }\n  }\n\n  // ç§»é™¤æœªä½¿ç”¨çš„å‡½æ•°ï¼šaddNewSegment, insertSegmentAfter, deleteSegment\n\n  // ç§»é™¤æœªä½¿ç”¨çš„å‡½æ•°ä»¥ä¿®å¤ESLinté”™è¯¯\n\n  // æ™ºèƒ½æ£€æµ‹ç›¸å…³æ–¹æ³•\n  // æ™ºèƒ½æ£€æµ‹æ–¹æ³•å·²ç§»è‡³IntelligentDetectorç»„ä»¶\n\n  // æ™ºèƒ½æ£€æµ‹ç›¸å…³æ–¹æ³•å·²ç§»è‡³IntelligentDetectorç»„ä»¶\n\n  // jumpToSegmentå‡½æ•°å·²ç§»é™¤ï¼ˆæœªä½¿ç”¨ï¼‰\n\n  // ğŸ”¥ æ–°å¢ï¼šè§’è‰²ç›¸å…³äº‹ä»¶å¤„ç†æ–¹æ³•\n  const handleHighlightCharacter = (characterName) => {\n    if (highlightedCharacter.value === characterName) {\n      highlightedCharacter.value = null\n      message.info('å–æ¶ˆé«˜äº®')\n    } else {\n      highlightedCharacter.value = characterName\n      message.info(`é«˜äº®è§’è‰²\"${characterName}\"çš„ç‰‡æ®µ`)\n      // åˆ‡æ¢åˆ°ç‰‡æ®µtab\n      activeTab.value = 'segments'\n    }\n  }\n\n  const handleExportSegments = (characterName) => {\n    const characterSegments = editableSegments.value\n      .filter((segment) => segment.speaker === characterName)\n      .map((segment, index) => `${index + 1}. ${segment.text}`)\n      .join('\\n\\n')\n\n    if (characterSegments) {\n      const blob = new Blob([`è§’è‰²\"${characterName}\"çš„ç‰‡æ®µï¼š\\n\\n${characterSegments}`], {\n        type: 'text/plain;charset=utf-8'\n      })\n      const url = URL.createObjectURL(blob)\n      const link = document.createElement('a')\n      link.href = url\n      link.download = `ç¬¬${props.chapter?.number}ç« _${characterName}_ç‰‡æ®µ.txt`\n      document.body.appendChild(link)\n      link.click()\n      document.body.removeChild(link)\n      URL.revokeObjectURL(url)\n      message.success(`è§’è‰²\"${characterName}\"çš„ç‰‡æ®µå¯¼å‡ºæˆåŠŸ`)\n    } else {\n      message.warning(`è§’è‰²\"${characterName}\"æ²¡æœ‰ç‰‡æ®µ`)\n    }\n  }\n\n  const handleTestVoice = (characterName) => {\n    testingVoice.value = characterName\n    message.info(`æ­£åœ¨æµ‹è¯•è§’è‰²\"${characterName}\"çš„è¯­éŸ³...`)\n    \n    // æ¨¡æ‹Ÿè¯­éŸ³æµ‹è¯•è¿‡ç¨‹\n    setTimeout(() => {\n      testingVoice.value = null\n      message.success(`è§’è‰²\"${characterName}\"çš„è¯­éŸ³æµ‹è¯•å®Œæˆ`)\n    }, 2000)\n  }\n\n  // ğŸ”¥ æ–°å¢ï¼šä¿å­˜JSONæ•°æ®çš„æ–¹æ³•\n  const handleSaveJson = () => {\n    try {\n      const jsonData = {\n        chapter: props.chapter,\n        segments: editableSegments.value,\n        characters: editableCharacters.value,\n        synthesis_json: props.analysisData?.synthesis_json\n      }\n      \n      const blob = new Blob([JSON.stringify(jsonData, null, 2)], {\n        type: 'application/json;charset=utf-8'\n      })\n      const url = URL.createObjectURL(blob)\n      const link = document.createElement('a')\n      link.href = url\n      link.download = `ç¬¬${props.chapter?.number}ç« _åˆ†ææ•°æ®.json`\n      document.body.appendChild(link)\n      link.click()\n      document.body.removeChild(link)\n      URL.revokeObjectURL(url)\n      message.success('JSONæ•°æ®å¯¼å‡ºæˆåŠŸ')\n    } catch (error) {\n      console.error('å¯¼å‡ºJSONå¤±è´¥:', error)\n      message.error('å¯¼å‡ºJSONæ•°æ®å¤±è´¥')\n    }\n  }\n\n  // ğŸ”¥ æ–°å¢ï¼šæ‰¹é‡åˆ›å»ºè§’è‰²æ¨¡æ€æ¡†çš„å¯è§æ€§\n  const batchCreateModalVisible = ref(false)\n\n  // ğŸ”¥ æ–°å¢ï¼šæ˜¾ç¤ºæ‰¹é‡åˆ›å»ºè§’è‰²æ¨¡æ€æ¡†çš„å¤„ç†å‡½æ•°\n  const showBatchCreateModal = () => {\n    batchCreateModalVisible.value = true\n  }\n\n  // ğŸ”¥ æ–°å¢ï¼šè®¡ç®—å±æ€§ bookId å’Œ chapterId\n  const bookId = computed(() => props.chapter?.book_id)\n  const chapterId = computed(() => props.chapter?.id)\n\n  // ğŸ”¥ æ–°å¢ï¼šå¤„ç† JSON æ•°æ®å˜åŒ–çš„æ–¹æ³•\n  const handleJsonChanged = (data) => {\n    console.log('[ChapterAnalysis] JSON æ•°æ®å·²æ›´æ”¹')\n    if (data.segments) {\n      editableSegments.value = data.segments\n    }\n    if (data.characters) {\n      editableCharacters.value = data.characters\n    }\n    markChanged()\n    message.success('JSON æ•°æ®å·²æ›´æ–°')\n  }\n\n  // ğŸ”¥ æ–°å¢ï¼šå¤„ç†è§’è‰²åˆ›å»ºå®Œæˆçš„æ–¹æ³•\n  const handleCharactersCreated = (createdCharacters) => {\n    console.log('[ChapterAnalysis] è§’è‰²åˆ›å»ºå®Œæˆ:', createdCharacters)\n    // é‡æ–°åŠ è½½æœ¬ä¹¦è§’è‰²\n    loadBookCharacters()\n    // æ›´æ–°è§’è‰²ä¿¡æ¯\n    editableCharacters.value = editableCharacters.value.map(char => {\n      const created = createdCharacters.find(c => c.name === char.name)\n      if (created) {\n        return {\n          ...char,\n          character_id: created.character_id,\n          in_character_library: true,\n          is_voice_configured: created.is_voice_configured || false\n        }\n      }\n      return char\n    })\n    markChanged()\n    message.success(`æˆåŠŸåˆ›å»º ${createdCharacters.length} ä¸ªè§’è‰²`)\n  }\n\n  // é‡å¤å®šä¹‰å·²åˆ é™¤ï¼Œä½¿ç”¨å‰é¢çš„refreshCharacterLibraryå‡½æ•°\n</script>\n\n<style scoped>\n  .chapter-analysis {\n    height: 100%;\n    display: flex;\n    flex-direction: column;\n    overflow: hidden;\n  }\n\n  .loading-wrapper {\n    flex: 1;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n  }\n\n  .analysis-content {\n    flex: 1;\n    display: flex;\n    flex-direction: column;\n    overflow: hidden;\n  }\n\n  .analysis-toolbar {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    padding: 12px 16px;\n  }\n\n  .analysis-tabs {\n    flex: 1;\n    overflow: hidden;\n\n    :deep(.ant-tabs) {\n\n      height: 100%;\n      display: flex;\n      flex-direction: column;\n\n      .ant-tabs-nav {\n        background: var(--component-background);\n        border-bottom: 1px solid var(--border-color-base);\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n\n        &::before {\n          display: none;\n        }\n\n        .ant-tabs-nav-wrap {\n          flex: 1;\n        }\n\n        .ant-tabs-extra-content {\n          margin-left: 16px;\n        }\n      }\n    }\n\n    :deep(.ant-tabs-content-holder) {\n      flex: 1;\n      overflow: auto;\n    }\n  }\n\n  .segments-view {\n    padding: 16px;\n    height: 100%;\n    overflow-y: auto;\n  }\n\n  .segments-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 16px;\n  }\n\n  .segments-header h4 {\n    margin: 0;\n    color: #1f2937;\n  }\n\n  .segment-count {\n    font-size: 12px;\n    color: #6b7280;\n  }\n\n  /* æ®µè½ç¼–è¾‘å™¨æ ·å¼ */\n  .segments-editor {\n    border: 1px solid #e8e8e8;\n    border-radius: 8px;\n    overflow: hidden;\n  }\n\n  .editor-header {\n    padding: 12px 16px;\n    border-bottom: 1px solid #e8e8e8;\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n  }\n\n  .editor-header h4 {\n    margin: 0;\n    font-size: 14px;\n    color: #333;\n  }\n\n  .editor-controls {\n    display: flex;\n    gap: 8px;\n  }\n\n  /* .segments-list æ ·å¼å·²ç§»é™¤ï¼Œä½¿ç”¨é»˜è®¤æ ·å¼ */\n\n  .segment-item {\n    padding: 12px 16px;\n    border-bottom: 1px solid #f0f0f0;\n    transition: all 0.2s ease;\n  }\n\n  .segment-item:hover {\n    background: #fafafa;\n  }\n\n  .segment-item:last-child {\n    border-bottom: none;\n  }\n\n  .segment-header {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    margin-bottom: 8px;\n  }\n\n  .segment-index {\n    font-weight: 500;\n    color: #666;\n    min-width: 40px;\n  }\n\n  .segment-actions {\n    display: flex;\n    gap: 4px;\n    margin-left: auto;\n    opacity: 0;\n    transition: opacity 0.2s ease;\n  }\n\n  .segment-item:hover .segment-actions {\n    opacity: 1;\n  }\n\n  .character-option {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    width: 100%;\n  }\n\n  .char-name {\n    flex: 1;\n    margin-right: 8px;\n  }\n\n  /* æ®µè½é«˜äº®æ ·å¼ */\n  .segment-highlighted {\n    background: #e6f7ff;\n    border-left: 3px solid #1890ff;\n  }\n\n  .segment-dimmed {\n    opacity: 0.5;\n  }\n\n  /* æ‹–æ‹½æ’åºæ ·å¼ */\n  .segment-ghost {\n    opacity: 0.5;\n    background: #f0f0f0;\n    border: 2px dashed #d9d9d9;\n  }\n\n  .segment-chosen {\n    background: #e6f7ff;\n    border-left: 3px solid #1890ff;\n  }\n\n  .segment-drag {\n    background: #fff;\n    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);\n    border: 1px solid #1890ff;\n    border-radius: 4px;\n    transform: rotate(5deg);\n  }\n\n  /* å“åº”å¼è®¾è®¡ */\n  @media (max-width: 768px) {\n    .editor-header {\n      flex-direction: column;\n      gap: 8px;\n      align-items: flex-start;\n    }\n\n    .editor-controls {\n      width: 100%;\n      justify-content: flex-end;\n    }\n\n    .segment-header {\n      flex-wrap: wrap;\n      gap: 4px;\n    }\n\n    .segment-actions {\n      opacity: 1; /* ç§»åŠ¨ç«¯å§‹ç»ˆæ˜¾ç¤º */\n    }\n  }\n\n  .segment-content {\n    margin-top: 8px;\n  }\n\n  .json-view {\n    padding: 16px;\n    height: 100%;\n    overflow-y: auto;\n  }\n\n  .json-header {\n    margin-bottom: 16px;\n    padding: 8px 0;\n    border-bottom: 1px solid #f0f0f0;\n  }\n\n  .json-editor {\n    height: calc(100% - 100px);\n  }\n\n  .json-display {\n    font-family: 'Courier New', monospace;\n    font-size: 12px;\n    line-height: 1.4;\n    background: #f8fafc;\n    border: 1px solid #e5e7eb;\n    border-radius: 6px;\n    resize: none;\n    height: 100%;\n  }\n\n  .json-display.editable {\n    border-color: #40a9ff;\n    box-shadow: 0 0 0 2px rgba(64, 169, 255, 0.2);\n    background-color: #fafafa;\n  }\n\n  .json-display.editable:focus {\n    border-color: #40a9ff;\n    box-shadow: 0 0 0 2px rgba(64, 169, 255, 0.3);\n  }\n\n  .characters-view {\n    padding: 16px;\n    height: 100%;\n    overflow-y: auto;\n  }\n\n  .characters-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 16px;\n  }\n\n  .characters-header h4 {\n    margin: 0;\n    color: #1f2937;\n  }\n\n  .character-stats {\n    font-size: 12px;\n    color: #6b7280;\n  }\n\n  .characters-grid {\n    display: grid;\n    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));\n    gap: 16px;\n    margin-top: 16px;\n  }\n\n  .character-card {\n    border: 1px solid #e5e7eb;\n    border-radius: 12px;\n    padding: 16px;\n    background: #fff;\n    transition: all 0.2s;\n    position: relative;\n    overflow: hidden;\n  }\n\n  .character-card:hover {\n    border-color: #3b82f6;\n    box-shadow: 0 4px 12px rgba(59, 130, 246, 0.1);\n  }\n\n  .character-header {\n    display: flex;\n    align-items: center;\n    gap: 12px;\n    margin-bottom: 12px;\n  }\n\n  .character-avatar {\n    flex-shrink: 0;\n  }\n\n  .character-info {\n    flex: 1;\n    min-width: 0;\n  }\n\n  .character-name {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    margin-bottom: 4px;\n  }\n\n  .name-text {\n    font-size: 16px;\n    font-weight: 600;\n    color: #1f2937;\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n  }\n\n  .character-rank {\n    font-size: 12px;\n    color: #6b7280;\n    flex-shrink: 0;\n  }\n\n  .character-tags {\n    display: flex;\n    flex-wrap: wrap;\n    gap: 4px;\n    margin-top: 4px;\n  }\n\n  .character-details {\n    margin-top: 12px;\n  }\n\n  .character-actions {\n    margin-top: 12px;\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    gap: 8px;\n  }\n\n  .no-analysis {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    height: 100%;\n    text-align: center;\n  }\n\n  .empty-icon {\n    font-size: 48px;\n    margin-bottom: 16px;\n    opacity: 0.5;\n  }\n\n  .no-analysis p {\n    color: #6b7280;\n    margin: 8px 0 16px 0;\n  }\n\n  /* ğŸ”¥ æ–°å¢ï¼šè§’è‰²å¤´éƒ¨å¸ƒå±€æ ·å¼ */\n  .characters-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: flex-start;\n    margin-bottom: 20px;\n    padding-bottom: 12px;\n    border-bottom: 1px solid #f0f0f0;\n  }\n\n  .characters-title {\n    flex: 1;\n  }\n\n  .characters-actions {\n    flex-shrink: 0;\n  }\n\n  /* ğŸ”¥ æ–°å¢ï¼šæ‰¹é‡åˆ›å»ºæŠ½å±‰æ ·å¼ */\n  .batch-create-content {\n    height: 100%;\n    display: flex;\n    flex-direction: column;\n  }\n\n  .batch-create-body {\n    flex: 1;\n    padding-right: 8px;\n  }\n\n  .selection-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 16px;\n  }\n\n  .selection-header h4 {\n    margin: 0;\n  }\n\n  .characters-grid-batch {\n    display: grid;\n    grid-template-columns: 1fr;\n    gap: 12px;\n    max-height: 400px;\n    overflow-y: auto;\n    padding: 8px;\n    border: 1px solid #f0f0f0;\n    border-radius: 6px;\n  }\n\n  .character-batch-item {\n    border: 1px solid #e8e8e8;\n    border-radius: 8px;\n    padding: 12px;\n    transition: all 0.2s ease;\n  }\n\n  .character-batch-item:hover {\n    border-color: #1890ff;\n    background-color: #f6f9ff;\n  }\n\n  .character-batch-info {\n    width: 100%;\n  }\n\n  .character-batch-header {\n    display: flex;\n    align-items: center;\n    gap: 12px;\n  }\n\n  .character-batch-details {\n    flex: 1;\n  }\n\n  .character-batch-details .character-name {\n    font-weight: 600;\n    font-size: 14px;\n    margin-bottom: 4px;\n  }\n\n  .character-batch-details .character-meta {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    font-size: 12px;\n    color: #666;\n  }\n\n  .character-count {\n    background: #f0f0f0;\n    padding: 2px 6px;\n    border-radius: 4px;\n    font-size: 11px;\n  }\n\n  .voice-config-form {\n    background: #fafafa;\n    padding: 12px;\n    border-radius: 6px;\n    margin-top: 8px;\n  }\n\n  .batch-summary {\n    margin-top: 16px;\n  }\n\n  .summary-info h4 {\n    margin: 0 0 8px 0;\n    color: #1890ff;\n  }\n\n  .summary-info p {\n    margin: 4px 0;\n  }\n\n  .summary-note {\n    color: #52c41a;\n    font-size: 13px;\n    background: #f6ffed;\n    padding: 8px;\n    border-radius: 4px;\n    border-left: 3px solid #52c41a;\n  }\n\n  /* ğŸ”¥ æ–°å¢ï¼šéŸ³é¢‘ä¸Šä¼ æ ·å¼ */\n  .audio-upload-section {\n    margin-top: 8px;\n  }\n\n  .upload-tips {\n    margin-top: 8px;\n  }\n\n  .upload-tips .ant-alert {\n    border-radius: 4px;\n  }\n\n  /* ä¼˜åŒ–æŠ½å±‰footer */\n  .drawer-footer {\n    box-shadow: 0 -2px 8px rgba(0, 0, 0, 0.05);\n  }\n\n  /* æ–‡ä»¶ä¸Šä¼ æŒ‰é’®æ ·å¼ */\n  .audio-upload-section .ant-upload {\n    display: block;\n    width: 100%;\n  }\n\n  .audio-upload-section .ant-btn {\n    height: 32px;\n    font-size: 12px;\n  }\n\n  /* ğŸ”¥ æ–°å¢ï¼šè§’è‰²è¡¨æ ¼æ ·å¼ */\n  .characters-table {\n    margin-top: 16px;\n  }\n\n  .character-name-cell .name {\n    font-weight: 500;\n    margin-bottom: 4px;\n  }\n\n  .character-name-cell .meta {\n    display: flex;\n    gap: 8px;\n  }\n\n  .description-cell {\n    max-width: 200px;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    white-space: nowrap;\n  }\n\n  /* ğŸ”¥ æ–°å¢ï¼šç»Ÿä¸€éŸ³é¢‘é…ç½®æ ·å¼ */\n  .audio-config-content {\n    height: 100%;\n    display: flex;\n    flex-direction: column;\n  }\n\n  .audio-config-body {\n    flex: 1;\n    padding-right: 8px;\n  }\n\n  .config-description {\n    color: #666;\n    font-size: 14px;\n    margin-bottom: 20px;\n    line-height: 1.6;\n  }\n\n  .unified-audio-upload {\n    margin-top: 12px;\n  }\n\n  .unified-audio-upload .ant-btn {\n    border-style: dashed;\n    color: #666;\n  }\n\n  .unified-audio-upload .ant-btn:hover {\n    border-color: #1890ff;\n    color: #1890ff;\n  }\n\n  /* æ™ºèƒ½æ£€æµ‹æ ·å¼å·²ç§»è‡³IntelligentDetectorç»„ä»¶ */\n\n  /* ç©ºæ–‡æœ¬è­¦å‘Šæ ·å¼ */\n  .empty-text-warning {\n    border-color: #ff7875 !important;\n    background-color: #fff2f0 !important;\n  }\n\n  .empty-text-warning:focus {\n    border-color: #ff7875 !important;\n    box-shadow: 0 0 0 2px rgba(255, 120, 117, 0.2) !important;\n  }\n\n  .empty-text-hint {\n    margin-top: 8px;\n    padding: 8px 12px;\n    background: #fff7e6;\n    border: 1px solid #ffd591;\n    border-radius: 6px;\n    font-size: 12px;\n    color: #d46b08;\n    line-height: 1.5;\n  }\n\n  .empty-text-hint br {\n    margin: 2px 0;\n  }\n</style>\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]}]